<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vitamin</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0a0a;
      --bg-secondary: #141414;
      --bg-tertiary: #1a1a1a;
      --accent: #ff6b00;
      --accent-dim: #cc5500;
      --text-primary: #ffffff;
      --text-secondary: #888888;
      --text-muted: #555555;
      --border: #252525;
    }

    body.light {
      --bg-primary: #ffffff;
      --bg-secondary: #f5f5f5;
      --bg-tertiary: #e0e0e0;
      --text-primary: #333333;
      --text-secondary: #666666;
      --text-muted: #999999;
      --border: #b0b0b0;
      --accent: #ff6b00;
      --accent-dim: #cc5500;
    }

    /* Vitamin (B)luezon - Blue theme */
    body.blueberry {
      --accent: #4a90d9;
      --accent-dim: #3a7bc8;
    }

    /* Vitamin (A)methyst - Purple theme */
    body.acai {
      --accent: #9b59b6;
      --accent-dim: #8e44ad;
    }

    /* Vitamin (E)nigma - Green theme */
    body.emerald {
      --accent: #2ecc71;
      --accent-dim: #27ae60;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      overflow: hidden;
    }

    .toolbar {
      display: flex;
      align-items: center;
      padding: 10px 16px 12px;
      padding-left: 80px; /* Space for macOS traffic lights */
      gap: 12px;
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      -webkit-app-region: drag;
    }

    body.light .toolbar {
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .nav-buttons {
      display: flex;
      gap: 2px;
      -webkit-app-region: no-drag;
    }

    .nav-btn {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .nav-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-btn {
      position: relative;
    }

    .nav-badge {
      position: absolute;
      top: 3px;
      right: 3px;
      width: 6px;
      height: 6px;
      background: var(--accent);
      border-radius: 50%;
      display: none;
      box-shadow: 0 0 4px var(--accent);
    }

    .nav-badge.show {
      display: block;
      animation: pulse-glow 1.5s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { opacity: 1; box-shadow: 0 0 4px var(--accent); }
      50% { opacity: 0.7; box-shadow: 0 0 8px var(--accent); }
    }

    /* Context Menu */
    .context-menu {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      padding: 4px 0;
      min-width: 200px;
    }

    .context-menu-item {
      padding: 8px 12px;
      font-size: 13px;
      color: var(--text-primary);
      cursor: pointer;
      display: flex;
      align-items: center;
    }

    .context-menu-item:hover {
      background: var(--bg-tertiary);
    }

    .context-menu-separator {
      height: 1px;
      background: var(--border);
      margin: 4px 0;
    }

    /* Tab Container - Holds buttons + scrollable tabs */
    .tab-container {
      display: flex;
      align-items: center;
      gap: 2px;
      min-width: 120px;
      max-width: 400px;
      -webkit-app-region: no-drag;
      padding: 3px 4px;
      height: 36px;
      background: var(--bg-secondary);
      border-radius: 10px;
      border: 1px solid var(--border);
      box-sizing: border-box;
    }

    /* Compact tabs for when there are more than 4 tabs */
    .tab-container.compact .tab {
      min-width: 32px;
      max-width: 32px;
      padding: 0 4px;
      gap: 0;
    }

    .tab-container.compact .tab-title {
      display: none;
    }

    .tab-container.compact .tab-favicon,
    .tab-container.compact .tab-favicon-placeholder {
      margin: 0 auto;
    }

    /* Tab Bar - Scrollable area for tabs only */
    .tab-bar {
      display: flex;
      align-items: center;
      gap: 2px;
      flex: 1;
      min-width: 0;
      overflow-x: auto;
      overflow-y: hidden;
      scrollbar-width: none;
    }

    .tab-bar::-webkit-scrollbar {
      display: none;
    }

    .tab {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0 8px;
      height: 28px;
      background: transparent;
      border-radius: 6px;
      cursor: pointer;
      min-width: 80px;
      max-width: 120px;
      flex: 0 0 auto;
      transition: background 0.15s ease;
      overflow: hidden;
    }

    .tab:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .tab.active {
      background: var(--bg-tertiary);
    }

    .tab-favicon {
      width: 14px;
      height: 14px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    .tab-favicon-placeholder {
      width: 14px;
      height: 14px;
      border-radius: 2px;
      background: var(--text-muted);
      opacity: 0.3;
      flex-shrink: 0;
    }

    .tab-title {
      font-size: 11px;
      font-weight: 450;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex: 1;
      min-width: 0;
    }

    .tab.active .tab-title {
      color: var(--text-primary);
    }

    .new-tab-btn, .close-tab-btn {
      width: 22px;
      height: 22px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      border-radius: 5px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      flex-shrink: 0;
    }

    .new-tab-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      color: var(--text-primary);
    }

    .close-tab-btn {
      font-size: 16px;
      font-weight: 300;
      line-height: 1;
    }

    .close-tab-btn:hover {
      background: rgba(255, 100, 100, 0.15);
      color: #ff6b6b;
    }

    .tab-divider {
      width: 1px;
      height: 16px;
      background: var(--border);
      margin: 0 4px;
      flex-shrink: 0;
    }

    .url-container {
      flex: 1;
      -webkit-app-region: no-drag;
    }

    .url-bar {
      width: 100%;
      height: 36px;
      padding: 0 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 13px;
      transition: all 0.15s ease;
    }

    .url-bar:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--bg-tertiary);
    }

    .url-bar::placeholder {
      color: var(--text-muted);
    }

    .poison-control {
      display: flex;
      align-items: center;
      gap: 10px;
      -webkit-app-region: no-drag;
    }

    .poison-btn {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      -webkit-app-region: no-drag;
    }

    .poison-btn:hover,
    .poison-btn.hover-persist {
      border-color: var(--accent-dim);
      color: var(--accent);
      transform: scale(1.02);
    }

    .poison-btn.hover-persist {
      transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .poison-btn.active {
      border-color: var(--accent);
      background: rgba(255, 107, 0, 0.08);
      color: var(--accent);
      animation: glowPulse 3s ease-in-out infinite;
    }

    body.blueberry .poison-btn.active { background: rgba(74, 144, 217, 0.08); }
    body.acai .poison-btn.active { background: rgba(155, 89, 182, 0.08); }
    body.emerald .poison-btn.active { background: rgba(46, 204, 113, 0.08); }

    @keyframes glowPulse {
      0%, 100% { box-shadow: 0 0 8px rgba(255, 107, 0, 0.3); }
      50% { box-shadow: 0 0 20px rgba(255, 107, 0, 0.5); }
    }

    body.blueberry .poison-btn.active {
      animation: glowPulseBlue 3s ease-in-out infinite;
    }
    @keyframes glowPulseBlue {
      0%, 100% { box-shadow: 0 0 8px rgba(74, 144, 217, 0.3); }
      50% { box-shadow: 0 0 20px rgba(74, 144, 217, 0.5); }
    }

    body.acai .poison-btn.active {
      animation: glowPulsePurple 3s ease-in-out infinite;
    }
    @keyframes glowPulsePurple {
      0%, 100% { box-shadow: 0 0 8px rgba(155, 89, 182, 0.3); }
      50% { box-shadow: 0 0 20px rgba(155, 89, 182, 0.5); }
    }

    body.emerald .poison-btn.active {
      animation: glowPulseGreen 3s ease-in-out infinite;
    }
    @keyframes glowPulseGreen {
      0%, 100% { box-shadow: 0 0 8px rgba(46, 204, 113, 0.3); }
      50% { box-shadow: 0 0 20px rgba(46, 204, 113, 0.5); }
    }

    .poison-btn.active:hover {
      border-color: var(--accent);
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--text-muted);
      transition: background 0.15s ease;
    }

    .poison-btn.active .status-dot {
      background: var(--accent);
      animation: blink 1.2s ease-in-out infinite;
      box-shadow: 0 0 6px var(--accent);
    }

    .poison-btn.active .status-dot.flash {
      animation: flash 0.3s ease-out;
    }

    @keyframes flash {
      0% {
        transform: scale(1);
        box-shadow: 0 0 6px var(--accent);
      }
      50% {
        transform: scale(2.5);
        box-shadow: 0 0 20px var(--accent), 0 0 40px var(--accent);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 6px var(--accent);
      }
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }

    .dashboard {
      display: none; /* Hidden by default */
      align-items: center;
      gap: 20px;
      padding: 10px 16px;
      padding-left: 80px;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
      min-height: 44px;
      -webkit-app-region: no-drag;
    }

    .dashboard.visible {
      display: flex;
    }

    .stats {
      display: flex;
      gap: 20px;
    }

    .stat {
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .stat-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--accent);
      font-variant-numeric: tabular-nums;
    }

    .stat-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .divider {
      width: 1px;
      height: 20px;
      background: var(--border);
    }

    .activity-feed {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 10px;
      overflow: hidden;
    }

    .activity-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.3px;
      white-space: nowrap;
    }

    .activity-list {
      display: flex;
      gap: 6px;
      overflow: hidden;
    }

    .activity-item {
      padding: 4px 10px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      font-size: 11px;
      color: var(--text-secondary);
      white-space: nowrap;
      animation: slideIn 0.2s ease;
      border-left: 2px solid var(--border);
    }

    .activity-item.search {
      border-left-color: var(--accent);
    }

    .activity-item.visit {
      border-left-color: #888;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .empty-state {
      color: var(--text-muted);
      font-size: 11px;
    }

    /* Settings Button */
    .settings-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      -webkit-app-region: no-drag;
    }

    .settings-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    /* Window Controls (Linux & Windows) */
    .window-controls {
      display: none; /* Hidden by default, shown on non-macOS via JS */
      align-items: center;
      gap: 4px;
      margin-left: 8px;
      -webkit-app-region: no-drag;
    }

    .window-controls.non-mac {
      display: flex;
    }

    .window-control-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .window-control-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .window-control-btn.close:hover {
      background: #e81123;
      color: white;
    }

    /* Settings Panel */
    .settings-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: all 0.25s ease;
      z-index: 999;
    }

    .settings-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .settings-panel {
      position: fixed;
      top: 0;
      right: 0;
      width: 320px;
      height: 100vh;
      background: var(--bg-secondary);
      border-left: 1px solid var(--border);
      transform: translateX(100%);
      transition: transform 0.25s ease;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .settings-panel.open {
      transform: translateX(0);
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
      background: var(--bg-secondary);
    }

    .settings-content {
      flex: 1;
      min-height: 0;
      overflow-y: auto;
      padding-bottom: 20px;
    }

    .settings-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .settings-close {
      width: 36px;
      height: 36px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .settings-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .settings-section {
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .settings-label {
      display: block;
      font-size: 11px;
      font-weight: 500;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
    }

    .tier-selector {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .tier-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: left;
    }

    .tier-btn:hover {
      border-color: var(--accent-dim);
      background: var(--bg-primary);
    }

    .tier-btn.selected {
      border-color: var(--accent-theme);
      background: var(--accent-theme-rgba);
    }

    .tier-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      min-width: 40px;
    }

    .tier-price {
      font-size: 12px;
      font-weight: 500;
      color: var(--accent);
      min-width: 50px;
    }

    .tier-desc {
      font-size: 11px;
      color: var(--text-muted);
      flex: 1;
    }

    /* Frequency selector */
    .frequency-selector {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .freq-btn {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: left;
    }

    .freq-btn:hover {
      border-color: var(--accent-dim);
      background: var(--bg-primary);
    }

    .freq-btn.selected {
      border-color: var(--accent-theme);
      background: var(--accent-theme-rgba);
    }

    .freq-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      min-width: 80px;
    }

    .freq-desc {
      font-size: 11px;
      color: var(--text-muted);
      flex: 1;
    }

    .settings-desc {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .persona-select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 13px;
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
    }

    .persona-select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .persona-select option {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }

    /* Toggle Switches - Simple Button Style */
    .toggle-switch {
      display: flex;
      align-items: center;
      padding: 16px 20px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
      margin-bottom: 12px;
      text-align: left;
    }

    .toggle-switch:hover {
      border-color: var(--accent-dim);
      background: var(--bg-secondary);
    }

    .toggle-switch.on {
      border-color: var(--accent-theme);
      background: var(--accent-theme);
      color: white;
    }

    .toggle-switch.on:hover {
      border-color: var(--accent);
      background: var(--accent);
    }

    .blocked-stat {
      margin-top: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      display: flex;
      align-items: baseline;
      gap: 6px;
    }

    .blocked-stat .stat-value {
      font-size: 20px;
    }

    .blocked-stat .stat-label {
      color: var(--text-secondary);
    }

    /* Feedback Button (toolbar) */
    .feedback-btn {
      background: var(--accent);
      border: none;
      color: white;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 6px;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 12px;
      font-weight: 500;
    }

    .feedback-btn:hover {
      background: var(--accent-hover);
      transform: scale(1.02);
    }

    /* What's New Modal */
    .whats-new-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .whats-new-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .whats-new-modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      width: 380px;
      max-width: 90vw;
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }

    .whats-new-overlay.open .whats-new-modal {
      transform: scale(1);
    }

    .whats-new-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .whats-new-icon {
      width: 40px;
      height: 40px;
      background: var(--accent);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .whats-new-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .whats-new-version {
      font-size: 13px;
      color: var(--text-muted);
    }

    .whats-new-list {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
    }

    .whats-new-list li {
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      color: var(--text-secondary);
      font-size: 13px;
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    .whats-new-list li:last-child {
      border-bottom: none;
    }

    .whats-new-list li::before {
      content: 'âœ“';
      color: var(--accent);
      font-weight: 600;
      flex-shrink: 0;
    }

    .whats-new-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: white;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .whats-new-btn:hover {
      background: var(--accent-hover);
    }

    /* Feedback Modal */
    .feedback-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .feedback-modal-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .feedback-modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      width: 340px;
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }

    .feedback-modal-overlay.open .feedback-modal {
      transform: scale(1);
    }

    .feedback-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
      text-align: center;
    }

    .feedback-subtitle {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 20px;
      text-align: center;
    }

    .feedback-buttons {
      display: flex;
      gap: 16px;
      justify-content: center;
      margin-bottom: 16px;
    }

    .feedback-vote {
      width: 80px;
      height: 80px;
      border: 2px solid var(--border);
      border-radius: 16px;
      background: var(--bg-tertiary);
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
    }

    .feedback-vote:hover {
      border-color: var(--accent-dim);
      transform: scale(1.05);
    }

    .feedback-vote.selected {
      border-color: var(--accent-theme);
      background: var(--accent-theme-rgba);
    }

    .feedback-textarea {
      width: 100%;
      height: 80px;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 13px;
      resize: none;
      margin-bottom: 16px;
    }

    .feedback-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    .feedback-textarea::placeholder {
      color: var(--text-muted);
    }

    .feedback-actions {
      display: flex;
      gap: 10px;
    }

    .feedback-cancel {
      flex: 1;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .feedback-cancel:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .feedback-submit {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: white;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .feedback-submit:hover {
      background: var(--accent-dim);
    }

    .feedback-submit:disabled {
      background: var(--bg-tertiary);
      color: var(--text-muted);
      cursor: not-allowed;
    }

    .feedback-thanks {
      text-align: center;
      padding: 20px;
    }

    .feedback-thanks-icon {
      font-size: 48px;
      margin-bottom: 12px;
    }

    .feedback-thanks-text {
      font-size: 14px;
      color: var(--text-secondary);
    }

    /* Appearance Button & Modal */
    .appearance-btn {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.15s ease;
      color: var(--text-primary);
    }

    .appearance-btn:hover {
      border-color: var(--accent);
    }

    .appearance-btn svg {
      margin-left: auto;
      color: var(--text-muted);
    }

    .appearance-preview {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: linear-gradient(135deg, #0d0d0d 50%, #ff6b00 50%);
      border: 2px solid var(--border);
    }

    body.light .appearance-preview {
      background: linear-gradient(135deg, #ffffff 50%, #ff6b00 50%);
    }

    .appearance-name {
      font-size: 14px;
      font-weight: 500;
    }

    .appearance-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .appearance-modal-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .appearance-modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      width: 360px;
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }

    .appearance-modal-overlay.open .appearance-modal {
      transform: scale(1);
    }

    .appearance-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .appearance-modal-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .appearance-modal-close {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .appearance-modal-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .theme-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .theme-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: var(--bg-tertiary);
      border: 2px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .theme-card:hover {
      border-color: var(--accent-dim);
    }

    .theme-card.selected {
      border-color: var(--accent);
      background: rgba(255, 107, 0, 0.1);
    }

    .theme-card-preview {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      border: 2px solid var(--border);
      flex-shrink: 0;
      position: relative;
      overflow: hidden;
    }

    .theme-card-preview.dark {
      background: #0d0d0d;
    }

    .theme-card-preview.dark::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
      background: #ff6b00;
      border-radius: 50% 0 0 0;
    }

    .theme-card-preview.light {
      background: #ffffff;
    }

    .theme-card-preview.light::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
      background: #ff6b00;
      border-radius: 50% 0 0 0;
    }

    .theme-card-preview.blueberry {
      background: #0d0d0d;
    }

    .theme-card-preview.blueberry::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
      background: #4a90d9;
      border-radius: 50% 0 0 0;
    }

    .theme-card-preview.acai {
      background: #0d0d0d;
    }

    .theme-card-preview.acai::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
      background: #9b59b6;
      border-radius: 50% 0 0 0;
    }

    .theme-card-preview.emerald {
      background: #0d0d0d;
    }

    .theme-card-preview.emerald::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 20px;
      height: 20px;
      background: #2ecc71;
      border-radius: 50% 0 0 0;
    }

    .theme-card-info {
      flex: 1;
    }

    .theme-card-name {
      font-size: 15px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .theme-card-desc {
      font-size: 12px;
      color: var(--text-muted);
    }

    .theme-card-check {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      color: transparent;
      transition: all 0.15s ease;
    }

    .theme-card.selected .theme-card-check {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    /* Update Banner */
    .update-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: linear-gradient(135deg, var(--accent), var(--accent-dim));
      padding: 10px 20px;
      display: none;
      align-items: center;
      justify-content: center;
      gap: 16px;
      z-index: 3000;
    }

    .update-banner.show {
      display: flex;
    }

    .update-text {
      font-size: 13px;
      font-weight: 500;
      color: white;
    }

    .update-install {
      padding: 6px 14px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 6px;
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .update-install:hover {
      background: rgba(255, 255, 255, 0.2);
      border-color: rgba(255, 255, 255, 0.5);
    }

    .update-dismiss {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      cursor: pointer;
      padding: 4px;
      display: flex;
      align-items: center;
    }

    .update-dismiss:hover {
      color: white;
    }

    /* Progress bar */
    .progress-bar {
      position: absolute;
      top: 105px;
      left: 0;
      width: 0%;
      height: 3px;
      background: linear-gradient(90deg, var(--accent), #ff8c00);
      z-index: 100;
      transition: width 0.2s ease;
      opacity: 0;
    }

    .progress-bar.loading {
      opacity: 1;
      animation: progress-pulse 1.5s ease-in-out infinite;
    }

    .progress-bar.complete {
      width: 100% !important;
      opacity: 0;
      transition: width 0.2s ease, opacity 0.3s ease 0.2s;
    }

    @keyframes progress-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Version in settings */
    .version-info {
      padding: 20px;
      border-top: 1px solid var(--border);
      margin-top: auto;
    }

    .version-text {
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
      margin-bottom: 10px;
    }

    .check-update-btn {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .check-update-btn:hover {
      border-color: var(--accent-dim);
      color: var(--accent);
    }

    .check-update-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Toolbar Buttons */
    .toolbar-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      -webkit-app-region: no-drag;
      position: relative;
    }

    .toolbar-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .toolbar-btn.active {
      color: var(--accent);
    }

    .toolbar-badge {
      position: absolute;
      top: 2px;
      right: 2px;
      width: 14px;
      height: 14px;
      background: var(--accent);
      border-radius: 50%;
      font-size: 9px;
      font-weight: 600;
      color: white;
      display: none;
      align-items: center;
      justify-content: center;
    }

    .toolbar-badge.show {
      display: flex;
    }

    /* Left Panel (Bookmarks, Downloads, History) */
    .left-panel {
      position: fixed;
      top: 0;
      left: 0;
      width: 320px;
      height: 100vh;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      transform: translateX(-100%);
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      z-index: 10000;
      display: flex;
      flex-direction: column;
    }

    .left-panel.open {
      transform: translateX(0);
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      border-bottom: 1px solid var(--border);
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .panel-close {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .panel-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .panel-actions {
      display: flex;
      gap: 8px;
      padding: 12px 20px;
      border-bottom: 1px solid var(--border);
    }

    .panel-action-btn {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 11px;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .panel-action-btn:hover {
      border-color: var(--accent-dim);
      color: var(--accent);
    }

    .panel-action-btn.danger:hover {
      border-color: #ef4444;
      color: #ef4444;
    }

    .panel-list {
      flex: 1;
      overflow-y: auto;
    }

    .panel-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 20px;
      cursor: pointer;
      transition: background 0.1s ease;
      border-bottom: 1px solid var(--border);
    }

    .panel-item:hover {
      background: var(--bg-tertiary);
    }

    .panel-item-icon {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      flex-shrink: 0;
    }

    .panel-item-icon-placeholder {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      background: var(--bg-tertiary);
      flex-shrink: 0;
    }

    .panel-item-content {
      flex: 1;
      min-width: 0;
    }

    .panel-item-title {
      font-size: 13px;
      color: var(--text-primary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .panel-item-subtitle {
      font-size: 11px;
      color: var(--text-muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-top: 2px;
    }

    .panel-item-remove {
      width: 20px;
      height: 20px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.1s ease;
    }

    .panel-item:hover .panel-item-remove {
      opacity: 1;
    }

    .panel-item-remove:hover {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .panel-item-edit {
      width: 20px;
      height: 20px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.1s ease;
      margin-right: 4px;
    }

    .panel-item:hover .panel-item-edit {
      opacity: 1;
    }

    .panel-item-edit:hover {
      background: var(--bg-primary);
      color: var(--accent);
    }

    /* Bookmark Edit Modal */
    .bookmark-edit-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .bookmark-edit-modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      width: 340px;
      max-width: 90vw;
    }

    .bookmark-edit-header {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
    }

    .bookmark-edit-field {
      margin-bottom: 12px;
    }

    .bookmark-edit-field label {
      display: block;
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 6px;
    }

    .bookmark-edit-field input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 13px;
    }

    .bookmark-edit-field input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .bookmark-edit-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      justify-content: flex-end;
    }

    .bookmark-edit-cancel {
      padding: 8px 16px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
    }

    .bookmark-edit-cancel:hover {
      background: var(--bg-tertiary);
    }

    .bookmark-edit-save {
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      color: white;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
    }

    .bookmark-edit-save:hover {
      background: var(--accent-dim);
    }

    /* Cookie Viewer */
    .cookie-domain {
      border-bottom: 1px solid var(--border);
    }

    .cookie-domain:last-child {
      border-bottom: none;
    }

    .cookie-domain-header {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      cursor: pointer;
      transition: background 0.1s;
    }

    .cookie-domain-header:hover {
      background: var(--bg-tertiary);
    }

    .cookie-expand-icon {
      color: var(--text-muted);
      transition: transform 0.15s;
      flex-shrink: 0;
    }

    .cookie-domain.expanded .cookie-expand-icon {
      transform: rotate(180deg);
    }

    .cookie-details {
      display: none;
      background: var(--bg-primary);
      border-top: 1px solid var(--border);
    }

    .cookie-domain.expanded .cookie-details {
      display: block;
    }

    .cookie-item {
      padding: 8px 16px 8px 48px;
      border-bottom: 1px solid var(--border);
    }

    .cookie-item:last-child {
      border-bottom: none;
    }

    .cookie-name {
      font-size: 11px;
      font-weight: 500;
      color: var(--accent);
      margin-bottom: 2px;
    }

    .cookie-value {
      font-size: 10px;
      color: var(--text-muted);
      font-family: monospace;
      word-break: break-all;
    }

    /* BTC Address */
    .btc-address-container {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px;
      background: var(--bg-tertiary);
      border-radius: 6px;
    }

    .btc-address {
      flex: 1;
      font-size: 9px;
      color: var(--text-muted);
      word-break: break-all;
      font-family: monospace;
    }

    .btc-copy-btn {
      width: 28px;
      height: 28px;
      border: none;
      background: var(--bg-secondary);
      color: var(--text-muted);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all 0.15s;
    }

    .btc-copy-btn:hover {
      background: var(--accent);
      color: white;
    }

    .btc-copy-btn.copied {
      background: #4ade80;
      color: white;
    }

    /* Payment Styles */
    .payment-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .payment-btn {
      width: 100%;
      padding: 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      text-align: center;
    }

    .payment-btn:hover {
      border-color: var(--accent);
      background: var(--bg-secondary);
    }

    .stripe-btn {
      background: #6772e5; /* Stripe blue */
      border-color: #6772e5;
      color: white;
    }

    .stripe-btn:hover {
      background: #5561d0;
      border-color: #5561d0;
    }

    .bitcoin-btn {
      background: #f7931a; /* Bitcoin orange */
      border-color: #f7931a;
      color: white;
    }

    .bitcoin-btn:hover {
      background: #e7830a;
      border-color: #e7830a;
    }

    .payment-field {
      margin-bottom: 15px;
    }

    .payment-field label {
      display: block;
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .payment-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 13px;
    }

    .payment-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .payment-submit-btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      background: var(--accent);
      color: white;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .payment-submit-btn:hover {
      background: var(--accent-dim);
    }

    .payment-submit-btn:disabled {
      background: var(--bg-tertiary);
      color: var(--text-muted);
      cursor: not-allowed;
    }

    .payment-error {
      font-size: 12px;
      color: #ff4757;
    }

    .payment-status {
      font-size: 12px;
      padding: 8px;
      border-radius: 6px;
      text-align: center;
    }

    .payment-status.success {
      background: rgba(46, 213, 115, 0.1);
      color: #2ed573;
    }

    .payment-status.error {
      background: rgba(255, 71, 87, 0.1);
      color: #ff4757;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-dot.active {
      background: #2ed573;
      box-shadow: 0 0 6px #2ed573;
    }

    .status-dot.inactive {
      background: #ff4757;
    }

    .cancel-subscription-btn {
      width: 100%;
      padding: 10px;
      border: 1px solid #ff4757;
      border-radius: 8px;
      background: transparent;
      color: #ff4757;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .cancel-subscription-btn:hover {
      background: rgba(255, 71, 87, 0.1);
    }

    .cancel-subscription-btn.full-width {
      width: 100%;
    }

    /* Subscription Management Styles */
    .subscription-info {
      background: var(--bg-tertiary);
      border-radius: 8px;
      padding: 15px;
      margin-top: 10px;
    }

    .subscription-details {
      margin-bottom: 15px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .detail-row:last-child {
      margin-bottom: 0;
    }

    .detail-label {
      font-size: 13px;
      color: var(--text-muted);
    }

    .detail-value {
      font-size: 13px;
      color: var(--text-primary);
      font-weight: 500;
    }

    .panel-empty {
      padding: 40px 20px;
      text-align: center;
      color: var(--text-muted);
      font-size: 12px;
    }

    /* Download specific styles */
    .download-progress {
      width: 100%;
      height: 3px;
      background: var(--bg-primary);
      border-radius: 2px;
      margin-top: 6px;
      overflow: hidden;
    }

    .download-progress-bar {
      height: 100%;
      background: var(--accent);
      transition: width 0.2s ease;
    }

    .panel-item-status {
      font-size: 11px;
      color: var(--text-muted);
    }

    .panel-item-status.completed {
      color: #4ade80;
    }

    /* Find Bar */
    .find-bar {
      position: fixed;
      top: 60px;
      right: 16px;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 12px;
      display: none;
      align-items: center;
      gap: 8px;
      z-index: 1002;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }

    .find-bar.open {
      display: flex;
    }

    .find-input {
      width: 200px;
      height: 28px;
      padding: 0 10px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 13px;
    }

    .find-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .find-count {
      font-size: 11px;
      color: var(--text-muted);
      min-width: 50px;
    }

    .find-nav-btn {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s ease;
    }

    .find-nav-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .find-close-btn {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s ease;
    }

    .find-close-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    /* Shred Buttons */
    .shred-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
      width: 100%;
      margin-top: 8px;
    }

    .shred-btn:hover {
      border-color: #ef4444;
      color: #ef4444;
      background: rgba(239, 68, 68, 0.1);
    }

    .shred-btn svg {
      flex-shrink: 0;
    }

    /* Changelog Button */
    .changelog-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
      width: 100%;
      margin-top: 8px;
    }

    .changelog-btn:hover {
      border-color: var(--accent-dim);
      color: var(--accent);
    }

    /* Vitali Greeting - subtle */
    .vitali-greeting {
      padding: 12px 0;
      text-align: center;
    }

    .vitali-text {
      font-size: 12px;
      color: var(--text-muted);
      font-style: italic;
    }

    /* Changelog Modal - full version list */
    .changelog-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .changelog-version {
      padding: 16px 0;
      border-bottom: 1px solid var(--border);
    }

    .changelog-version:last-child {
      border-bottom: none;
    }

    .changelog-version-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 8px;
    }

    .changelog-version-notes {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .changelog-version-notes li {
      font-size: 12px;
      color: var(--text-secondary);
      padding: 4px 0;
      padding-left: 16px;
      position: relative;
    }

    .changelog-version-notes li::before {
      content: 'â€¢';
      position: absolute;
      left: 0;
      color: var(--text-muted);
    }

    /* View buttons in settings */
    .view-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
      width: 100%;
      margin-bottom: 8px;
    }

    .view-btn:hover {
      border-color: var(--accent-dim);
      color: var(--accent);
    }

    /* Custom Persona Builder Modal */
    .persona-builder-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .persona-builder-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .persona-builder-modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 24px;
      width: 480px;
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }

    .persona-builder-overlay.open .persona-builder-modal {
      transform: scale(1);
    }

    .persona-builder-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .persona-builder-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .persona-builder-close {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .persona-builder-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .persona-builder-field {
      margin-bottom: 16px;
    }

    .persona-builder-field label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }

    .persona-builder-input {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 13px;
    }

    .persona-builder-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .persona-builder-textarea {
      width: 100%;
      height: 120px;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 13px;
      resize: vertical;
      font-family: inherit;
    }

    .persona-builder-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    .persona-builder-hint {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .persona-builder-actions {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }

    .persona-builder-btn {
      flex: 1;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .persona-builder-btn.secondary {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text-secondary);
    }

    .persona-builder-btn.secondary:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .persona-builder-btn.primary {
      background: var(--accent);
      border: none;
      color: white;
    }

    .persona-builder-btn.primary:hover {
      background: var(--accent-dim);
    }

    .persona-builder-btn.danger {
      background: transparent;
      border: 1px solid #ef4444;
      color: #ef4444;
    }

    .persona-builder-btn.danger:hover {
      background: rgba(239, 68, 68, 0.1);
    }

    /* Build Persona Button */
    .build-persona-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border: 1px solid var(--accent);
      border-radius: 8px;
      background: rgba(255, 107, 0, 0.1);
      color: var(--accent);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.15s ease;
      width: 100%;
      margin-top: 12px;
    }

    .build-persona-btn:hover {
      background: rgba(255, 107, 0, 0.2);
    }

    /* Custom persona list */
    .custom-personas-list {
      margin-top: 12px;
    }

    .custom-persona-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 12px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .custom-persona-name {
      font-size: 13px;
      color: var(--text-primary);
    }

    .custom-persona-actions {
      display: flex;
      gap: 6px;
    }

    .custom-persona-btn {
      width: 24px;
      height: 24px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.1s ease;
    }

    .custom-persona-btn:hover {
      background: var(--bg-primary);
      color: var(--text-primary);
    }

    .custom-persona-btn.delete:hover {
      color: #ef4444;
    }

    /* About Modal */
    .about-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      z-index: 2000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .about-overlay.open {
      opacity: 1;
      visibility: visible;
    }

    .about-modal {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 16px;
      width: 520px;
      max-width: 100%;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transform: scale(0.95);
      transition: transform 0.2s ease;
    }

    .about-overlay.open .about-modal {
      transform: scale(1);
    }

    .about-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }

    .about-logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .about-logo img {
      width: 40px;
      height: 40px;
      border-radius: 10px;
    }

    .about-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .about-version {
      font-size: 12px;
      color: var(--text-muted);
    }

    .about-close {
      width: 28px;
      height: 28px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .about-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .about-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .about-section {
      margin-bottom: 24px;
    }

    .about-section:last-child {
      margin-bottom: 0;
    }

    .about-section-title {
      font-size: 14px;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 10px;
    }

    .about-text {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.6;
    }

    .about-tier-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    .about-tier-table th {
      padding: 10px 8px;
      text-align: left;
      font-weight: 600;
      color: var(--text-primary);
      border-bottom: 1px solid var(--border);
    }

    .about-tier-table th:not(:first-child) {
      text-align: center;
    }

    .about-tier-table td {
      padding: 8px;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }

    .about-tier-table td:not(:first-child) {
      text-align: center;
    }

    .about-tier-table tr:last-child td {
      border-bottom: none;
    }

    .tier-check {
      color: #4ade80;
    }

    .tier-cross {
      color: var(--text-muted);
    }

    .about-footer {
      padding: 16px 20px;
      border-top: 1px solid var(--border);
      text-align: center;
      flex-shrink: 0;
    }

    .about-footer-text {
      font-size: 11px;
      color: var(--text-muted);
    }

    .about-footer-link {
      color: var(--accent);
      text-decoration: none;
    }

    .about-footer-link:hover {
      text-decoration: underline;
    }

    .about-replay-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      margin-bottom: 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: transparent;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s;
    }

    .about-replay-btn:hover {
      background: var(--bg-tertiary);
      border-color: var(--accent);
      color: var(--accent);
    }

    .about-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.15s ease;
      width: 100%;
      margin-top: 8px;
    }

    .about-btn:hover {
      border-color: var(--accent-dim);
      color: var(--accent);
    }

    /* Nuke Button */
    .nuke-btn {
      width: 100%;
      padding: 12px 16px;
      background: linear-gradient(45deg, #ff6b6b, #ff4757);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
      position: relative;
      overflow: hidden;
      /* Debug: Add border to see exact boundaries */
      border: 2px solid yellow !important;
      /* Debug: Add background color to make it more visible */
      background: linear-gradient(45deg, #ff6b6b, #ff4757) !important;
      /* Debug: Add high z-index to ensure it's on top */
      z-index: 9999 !important;
    }

    .nuke-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(255, 71, 87, 0.4);
    }

    .nuke-btn:active {
      transform: translateY(0);
    }

    .nuke-tier {
      margin-left: auto;
      background: rgba(255, 255, 255, 0.2);
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
    }

    .nuke-info {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Nuke Warning Modal */
    .nuke-warning-modal {
      background: var(--bg-primary);
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      width: 90%;
      border: 1px solid var(--border);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
    }

    .nuke-warning-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .nuke-warning-header h2 {
      color: #ff4757;
      margin-top: 16px;
      font-size: 24px;
      letter-spacing: 1px;
    }

    .nuke-warning-content {
      margin-bottom: 24px;
    }

    .nuke-warning-content p {
      color: var(--text-primary);
      margin-bottom: 16px;
      line-height: 1.5;
    }

    .warning-text {
      color: #ff4757;
      font-weight: 600;
    }

    .nuke-data-list {
      list-style: none;
      padding: 0;
      margin: 16px 0;
    }

    .nuke-data-list li {
      padding: 8px 0;
      padding-left: 24px;
      position: relative;
      color: var(--text-secondary);
    }

    .nuke-data-list li:before {
      content: "âœ“";
      position: absolute;
      left: 0;
      color: #2ed573;
      font-weight: bold;
    }

    .warning-note {
      font-size: 12px;
      color: var(--text-muted);
      font-style: italic;
      border-top: 1px solid var(--border);
      padding-top: 12px;
    }

    .nuke-warning-actions {
      display: flex;
      gap: 12px;
    }

    .nuke-cancel-btn {
      flex: 1;
      padding: 12px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
    }

    .nuke-cancel-btn:hover {
      background: var(--bg-secondary);
    }

    .nuke-confirm-btn {
      flex: 1;
      padding: 12px;
      background: linear-gradient(45deg, #ff6b6b, #ff4757);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .nuke-confirm-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
    }

    /* Nuke Progress Modal */
    .nuke-progress-modal {
      background: var(--bg-primary);
      border-radius: 12px;
      padding: 24px;
      max-width: 450px;
      width: 90%;
      border: 1px solid var(--border);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      text-align: center;
    }

    .nuke-animation-container {
      position: relative;
      width: 120px;
      height: 120px;
      margin: 0 auto 24px;
    }

    .nuke-core {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      background: #ff4757;
      border-radius: 50%;
      box-shadow: 0 0 20px #ff4757, 0 0 40px #ff6b6b;
      animation: pulse 1.5s infinite;
    }

    .nuke-shockwave {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid #ff4757;
      opacity: 0;
    }

    .nuke-shockwave.animate {
      animation: shockwave 2s infinite;
    }

    @keyframes shockwave {
      0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
        box-shadow: 0 0 10px #ff4757;
      }
      100% {
        transform: translate(-50%, -50%) scale(4);
        opacity: 0;
        box-shadow: 0 0 50px #ff6b6b;
      }
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 10px #ff4757, 0 0 20px #ff6b6b;
      }
      50% {
        box-shadow: 0 0 20px #ff4757, 0 0 40px #ff6b6b, 0 0 60px #ff4757;
      }
      100% {
        box-shadow: 0 0 10px #ff4757, 0 0 20px #ff6b6b;
      }
    }

    .nuke-particles {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #ff6b6b;
      border-radius: 50%;
      opacity: 0;
    }

    .nuke-countdown {
      font-size: 24px;
      font-weight: 700;
      color: #ff4757;
      font-family: 'Courier New', monospace;
      margin: 16px 0;
      text-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
    }

    .nuke-progress-bar {
      width: 100%;
      height: 8px;
      background: var(--bg-tertiary);
      border-radius: 4px;
      overflow: hidden;
      margin: 20px 0;
    }

    .nuke-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff6b6b, #ff4757);
      border-radius: 4px;
      width: 0%;
      transition: width 0.3s ease;
      box-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
    }

    .nuke-status {
      color: var(--text-secondary);
      font-size: 14px;
      margin-top: 16px;
    }

    .nuke-progress-content {
      text-align: center;
    }

    .nuke-progress-content h2 {
      color: #ff4757;
      font-size: 20px;
      margin-bottom: 16px;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
    }

    /* Modal Overlay */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(5px);
    }

  </style>
</head>
<body>
  <div class="toolbar">
    <div class="nav-buttons">
      <button class="nav-btn" id="back-btn" title="Back">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <button class="nav-btn" id="forward-btn" title="Forward">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
      <button class="nav-btn" id="refresh-btn" title="Refresh">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M23 4v6h-6"/><path d="M1 20v-6h6"/>
          <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
        </svg>
      </button>
      <button class="nav-btn" id="home-btn" title="Home">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
          <polyline points="9 22 9 12 15 12 15 22"/>
        </svg>
      </button>
      <button class="nav-btn" id="bookmark-btn" title="Bookmarks">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
        </svg>
      </button>
      <button class="nav-btn" id="downloads-btn" title="Downloads">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
          <polyline points="7 10 12 15 17 10"/>
          <line x1="12" y1="15" x2="12" y2="3"/>
        </svg>
        <span class="nav-badge" id="downloads-badge"></span>
      </button>
    </div>

    <div class="tab-container">
      <button class="new-tab-btn" id="new-tab-btn" title="New Tab (âŒ˜T)">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
      </button>
      <button class="close-tab-btn" id="close-tab-btn" title="Close Tab (âŒ˜W)">Ã—</button>
      <div class="tab-divider"></div>
      <div class="tab-bar" id="tab-bar">
        <!-- Tabs rendered dynamically -->
      </div>
    </div>

    <div class="url-container">
      <input type="text" class="url-bar" id="url-bar" placeholder="Search or enter address" />
    </div>

    <button class="poison-btn" id="poison-btn">
      <span class="status-dot"></span>
      <span id="poison-label">Poison</span>
    </button>

    <button class="toolbar-btn" id="discord-btn" title="Join Discord" style="-webkit-app-region: no-drag;" onclick="window.vitamin.openExternal('https://discord.gg/Udt3edD4DX')">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
      </svg>
    </button>

    <button class="settings-btn" id="settings-btn" title="Settings">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="3"/>
        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
      </svg>
    </button>

    <!-- Linux Window Controls -->
    <div class="window-controls" id="window-controls">
      <button class="window-control-btn" id="minimize-btn" title="Minimize">
        <svg width="12" height="12" viewBox="0 0 12 12">
          <rect x="1" y="5.5" width="10" height="1" fill="currentColor"/>
        </svg>
      </button>
      <button class="window-control-btn" id="maximize-btn" title="Maximize">
        <svg width="12" height="12" viewBox="0 0 12 12">
          <rect x="1.5" y="1.5" width="9" height="9" fill="none" stroke="currentColor" stroke-width="1"/>
        </svg>
      </button>
      <button class="window-control-btn close" id="close-btn" title="Close">
        <svg width="12" height="12" viewBox="0 0 12 12">
          <path d="M1 1l10 10M11 1L1 11" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="dashboard">
    <div class="stats">
      <div class="stat">
        <span class="stat-value" id="total-actions">0</span>
        <span class="stat-label">actions</span>
      </div>
      <div class="stat">
        <span class="stat-value" id="total-searches">0</span>
        <span class="stat-label">searches</span>
      </div>
      <div class="stat">
        <span class="stat-value" id="total-visits">0</span>
        <span class="stat-label">visits</span>
      </div>
    </div>

    <div class="divider"></div>

    <div class="activity-feed">
      <span class="activity-label">Activity</span>
      <div class="activity-list" id="activity-list">
        <span class="empty-state">No poison activity yet (à²¥ï¹à²¥) Toggle the supplement button to start protecting your privacy!</span>
      </div>
    </div>
  </div>

  <!-- Progress Bar -->
  <div class="progress-bar" id="progress-bar"></div>

  <!-- Find Bar -->
  <div class="find-bar" id="find-bar">
    <input type="text" class="find-input" id="find-input" placeholder="Find in page..." />
    <span class="find-count" id="find-count"></span>
    <button class="find-nav-btn" id="find-prev-btn" title="Previous">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="18 15 12 9 6 15"/>
      </svg>
    </button>
    <button class="find-nav-btn" id="find-next-btn" title="Next">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polyline points="6 9 12 15 18 9"/>
      </svg>
    </button>
    <button class="find-close-btn" id="find-close-btn" title="Close">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
  </div>

  <!-- Bookmarks Panel -->
  <div class="left-panel" id="bookmarks-panel">
    <div class="panel-header">
      <span class="panel-title">Bookmarks</span>
      <button class="panel-close" id="bookmarks-panel-close">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="panel-actions">
      <button class="panel-action-btn" id="add-bookmark-btn">Add Current Page</button>
    </div>
    <div class="panel-list" id="bookmarks-list">
      <div class="panel-empty">No bookmarks yet... sowwy (â•¥ï¹â•¥)</div>
    </div>
  </div>

  <!-- Downloads Panel -->
  <div class="left-panel" id="downloads-panel">
    <div class="panel-header">
      <span class="panel-title">Downloads</span>
      <button class="panel-close" id="downloads-panel-close">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="panel-actions">
      <button class="panel-action-btn" id="clear-downloads-btn">Clear Completed</button>
    </div>
    <div class="panel-list" id="downloads-list">
      <div class="panel-empty">No downloads... It's so empty in here ~(Ë˜â–¾Ë˜~)</div>
    </div>
  </div>

  <!-- History Panel -->
  <div class="left-panel" id="history-panel">
    <div class="panel-header">
      <span class="panel-title">History</span>
      <button class="panel-close" id="history-panel-close">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="panel-actions">
      <button class="panel-action-btn danger" id="shred-history-panel-btn">Shred All History</button>
    </div>
    <div class="panel-list" id="history-list">
      <div class="panel-empty">No history... Fresh start!</div>
    </div>
  </div>

  <!-- Cookies Panel -->
  <div class="left-panel" id="cookies-panel">
    <div class="panel-header">
      <span class="panel-title">Cookies</span>
      <button class="panel-close" id="cookies-panel-close">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
    <div class="panel-actions">
      <button class="panel-action-btn danger" id="shred-cookies-panel-btn">Shred All Cookies</button>
    </div>
    <div class="panel-list" id="cookies-list">
      <div class="panel-empty">No cookies... Nom nom nom</div>
    </div>
  </div>

  <!-- Settings Overlay -->
  <div class="settings-overlay" id="settings-overlay"></div>

  <!-- Settings Panel -->
  <div class="settings-panel" id="settings-panel">
    <div class="settings-header">
      <span class="settings-title">Settings</span>
      <button class="settings-close" id="settings-close" title="Close">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <div class="settings-content">
    <div class="settings-section">
      <label class="settings-label">Appearance</label>
      <button class="appearance-btn" id="appearance-btn">
        <span class="appearance-preview" id="appearance-preview"></span>
        <span class="appearance-name" id="appearance-name">Vitamin (D)ark</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M9 18l6-6-6-6"/>
        </svg>
      </button>
    </div>

    <div class="settings-section">
      <label class="settings-label">Poison Frequency</label>
      <div class="frequency-selector" id="frequency-selector">
        <button class="freq-btn" data-frequency="low">
          <span class="freq-name">Chill</span>
          <span class="freq-desc">45-90s intervals</span>
        </button>
        <button class="freq-btn selected" data-frequency="medium">
          <span class="freq-name">Standard</span>
          <span class="freq-desc">20-45s intervals</span>
        </button>
        <button class="freq-btn" data-frequency="high">
          <span class="freq-name">Aggressive</span>
          <span class="freq-desc">10-25s intervals</span>
        </button>
        <button class="freq-btn" data-frequency="max">
          <span class="freq-name">Overdose</span>
          <span class="freq-desc">5-15s intervals</span>
        </button>
      </div>
      <div class="frequency-warning" id="frequency-warning" style="display: none; margin-top: 10px; padding: 10px; background: rgba(255, 107, 0, 0.1); border: 1px solid var(--accent); border-radius: 8px; font-size: 12px; color: var(--accent);">
        <strong>Warning:</strong> <span id="frequency-warning-text"></span>
      </div>
    </div>

    <div class="settings-section persona-section" id="persona-section">
      <label class="settings-label">Persona</label>
      <p class="settings-desc">Create a fake profile that doesn't exist</p>
      <select class="persona-select" id="persona-select">
        <option value="">Select a persona...</option>
      </select>
      <button class="build-persona-btn" id="build-persona-btn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="5" x2="12" y2="19"/>
          <line x1="5" y1="12" x2="19" y2="12"/>
        </svg>
        <span>Build Your Own Persona</span>
      </button>
      <div class="custom-personas-list" id="custom-personas-list" style="display: none;"></div>
    </div>

    <div class="settings-section">
      <label class="settings-label">Privacy</label>
      <button class="toggle-switch on" id="adblock-toggle">
        Block Ads & Trackers
      </button>
      <div class="blocked-stat">
        <span class="stat-value" id="blocked-count">0</span>
        <span class="stat-label">requests blocked</span>
      </div>
    </div>

    <div class="settings-section">
      <label class="settings-label">Session</label>
      <button class="toggle-switch on" id="restore-session-toggle">
        Restore tabs on startup
      </button>
    </div>

    <div class="settings-section">
      <label class="settings-label">Performance</label>
      <button class="toggle-switch" id="performance-mode-toggle">
        Performance Mode (Reduces animations and effects)
      </button>
      <div class="settings-desc" id="performance-mode-info" style="display: none; margin-top: 8px;">
        <strong>Performance Mode Enabled:</strong> Animations disabled, reduced effects, faster rendering
        <br><span id="performance-savings">Estimated CPU/memory savings: 15-25%</span>
        <br><span id="performance-details" style="font-size: 10px; color: var(--text-muted); display: none;"></span>
      </div>
      <button class="view-btn" id="performance-details-btn" style="margin-top: 8px; display: none;">
        <span>Show Performance Details</span>
      </button>
    </div>

    <div class="settings-section">
      <label class="settings-label">History</label>
      <button class="view-btn" id="view-history-btn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <polyline points="12 6 12 12 16 14"/>
        </svg>
        <span>View History</span>
      </button>
    </div>

    <div class="settings-section">
      <label class="settings-label">Cookies</label>
      <button class="view-btn" id="view-cookies-btn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
        <span>View Cookies</span>
        <span id="cookie-count" style="margin-left: auto; color: var(--text-muted);">0</span>
      </button>
    </div>

    <div class="settings-section">
      <label class="settings-label">Nuke Data</label>
      <p class="settings-desc">Permanently destroy all browser data</p>
      <button class="nuke-btn" id="nuke-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="8"/>
          <line x1="12" y1="4" x2="12" y2="2"/>
          <line x1="12" y1="22" x2="12" y2="20"/>
          <line x1="20" y1="12" x2="22" y2="12"/>
          <line x1="2" y1="12" x2="4" y2="12"/>
          <line x1="17.5" y1="6.5" x2="19" y2="5"/>
          <line x1="5" y1="19" x2="6.5" y2="17.5"/>
          <line x1="17.5" y1="17.5" x2="19" y2="19"/>
          <line x1="5" y1="5" x2="6.5" y2="6.5"/>
        </svg>
        <span>Nuke All Data</span>
      </button>
      <p class="settings-desc" style="margin-top: 8px; font-size: 11px;">Deletes history, bookmarks, cookies, cache, settings, and all stored data. Browser will close.</p>
    </div>

    <div class="settings-section">
      <button class="changelog-btn" id="changelog-btn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/>
          <line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/>
        </svg>
        <span>View Changelog</span>
      </button>
      <button class="about-btn" id="about-btn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="16" x2="12" y2="12"/>
          <line x1="12" y1="8" x2="12.01" y2="8"/>
        </svg>
        <span>About Vitamin</span>
      </button>
    </div>

    <div class="settings-section">
      <label class="settings-label">Support Vitamin</label>
      <div class="btc-address-container">
        <div class="btc-address" id="btc-address">bc1p4d9aj6h3ndz2csfrdrxacvpuswzq4dvlt4zsjatj57p53rgjsamq8mnft5</div>
        <button class="btc-copy-btn" id="btc-copy-btn" title="Copy to clipboard">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="version-info">
      <p class="version-text">Vitamin v<span id="app-version">0.1.0</span></p>
      <div class="vitali-greeting">
        <p class="vitali-text">"hello hello" ~vitali</p>
      </div>
      <button class="toggle-switch on" id="auto-update-toggle">
        Auto-check updates on startup
      </button>
      <button class="check-update-btn" id="check-update-btn">Check for Updates</button>
    </div>
    </div>
  </div>

  <!-- Update Banner -->
  <div class="update-banner" id="update-banner">
    <span class="update-text">Update v<span id="update-version"></span> ready!</span>
    <button class="update-install" id="update-install-btn">Install & Restart</button>
    <button class="update-dismiss" id="update-dismiss-btn">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="18" y1="6" x2="6" y2="18"/>
        <line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
  </div>

  <!-- Custom Persona Builder Modal -->
  <div class="persona-builder-overlay" id="persona-builder-modal">
    <div class="persona-builder-modal">
      <div class="persona-builder-header">
        <span class="persona-builder-title" id="persona-builder-modal-title">Build Your Own Persona</span>
        <button class="persona-builder-close" id="persona-builder-close">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="persona-builder-field">
        <label for="persona-name-input">Persona Name</label>
        <input type="text" class="persona-builder-input" id="persona-name-input" placeholder="e.g., Crypto Bro, Wine Enthusiast" />
      </div>

      <div class="persona-builder-field">
        <label for="persona-desc-input">Description (optional)</label>
        <input type="text" class="persona-builder-input" id="persona-desc-input" placeholder="A brief description of this persona" />
      </div>

      <div class="persona-builder-field">
        <label for="persona-searches-input">Search Terms</label>
        <textarea class="persona-builder-textarea" id="persona-searches-input" placeholder="best crypto trading strategies
how to stake ethereum
what is bitcoin halving
NFT marketplace comparison"></textarea>
        <p class="persona-builder-hint">One search term per line. These will be used to poison search engines.</p>
      </div>

      <div class="persona-builder-field">
        <label for="persona-sites-input">Websites to Visit</label>
        <textarea class="persona-builder-textarea" id="persona-sites-input" placeholder="https://coinmarketcap.com
https://www.coingecko.com
https://decrypt.co
https://www.coindesk.com"></textarea>
        <p class="persona-builder-hint">One full URL per line (include https://). These sites will be visited.</p>
      </div>

      <div class="persona-builder-actions">
        <button class="persona-builder-btn secondary" id="persona-builder-cancel">Cancel</button>
        <button class="persona-builder-btn danger" id="persona-builder-delete" style="display: none;">Delete</button>
        <button class="persona-builder-btn primary" id="persona-builder-save">Save Persona</button>
      </div>
    </div>
  </div>

  <!-- What's New Modal -->
  <div class="whats-new-overlay" id="whats-new-modal">
    <div class="whats-new-modal">
      <div class="whats-new-header">
        <div class="whats-new-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            <path d="M2 17l10 5 10-5"/>
            <path d="M2 12l10 5 10-5"/>
          </svg>
        </div>
        <div>
          <div class="whats-new-title">What's New</div>
          <div class="whats-new-version">Version <span id="whats-new-version"></span></div>
        </div>
      </div>
      <ul class="whats-new-list" id="whats-new-list"></ul>
      <button class="whats-new-btn" id="whats-new-dismiss">Got it!</button>
    </div>
  </div>

  <!-- Changelog Modal -->
  <div class="whats-new-overlay" id="changelog-modal">
    <div class="whats-new-modal" style="width: 420px;">
      <div class="whats-new-header">
        <div class="whats-new-icon">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14 2 14 8 20 8"/>
          </svg>
        </div>
        <div>
          <div class="whats-new-title">Changelog</div>
          <div class="whats-new-version">All Updates</div>
        </div>
      </div>
      <div class="changelog-list" id="changelog-list"></div>
      <button class="whats-new-btn" id="changelog-dismiss">Close</button>
    </div>
  </div>


  <!-- Appearance Modal -->
  <div class="appearance-modal-overlay" id="appearance-modal">
    <div class="appearance-modal">
      <div class="appearance-modal-header">
        <span class="appearance-modal-title">Choose Theme</span>
        <button class="appearance-modal-close" id="appearance-modal-close" title="Close">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="theme-grid">
        <div class="theme-card selected" data-theme="dark">
          <div class="theme-card-preview dark"></div>
          <div class="theme-card-info">
            <div class="theme-card-name">Vitamin (D)ark</div>
            <div class="theme-card-desc">Classic dark mode with orange accents</div>
          </div>
          <div class="theme-card-check">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
        </div>
        <div class="theme-card" data-theme="light">
          <div class="theme-card-preview light"></div>
          <div class="theme-card-info">
            <div class="theme-card-name">Vitamin (C)reamsicle</div>
            <div class="theme-card-desc">Light mode with warm orange accents</div>
          </div>
          <div class="theme-card-check">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
        </div>
        <div class="theme-card" data-theme="blueberry">
          <div class="theme-card-preview blueberry"></div>
          <div class="theme-card-info">
            <div class="theme-card-name">Vitamin (B)luezon</div>
            <div class="theme-card-desc">Cool blue theme for focused work</div>
          </div>
          <div class="theme-card-check">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
        </div>
        <div class="theme-card" data-theme="acai">
          <div class="theme-card-preview acai"></div>
          <div class="theme-card-info">
            <div class="theme-card-name">Vitamin (A)methyst</div>
            <div class="theme-card-desc">Rich purple theme for creative work</div>
          </div>
          <div class="theme-card-check">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
        </div>
        <div class="theme-card" data-theme="emerald">
          <div class="theme-card-preview emerald"></div>
          <div class="theme-card-info">
            <div class="theme-card-name">Vitamin (E)nigma</div>
            <div class="theme-card-desc">Matrix-inspired green theme</div>
          </div>
          <div class="theme-card-check">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div class="about-overlay" id="about-modal">
    <div class="about-modal">
      <div class="about-header">
        <div class="about-logo">
          <img src="../assets/icon.png" alt="Vitamin">
          <div>
            <div class="about-title">Vitamin Browser</div>
            <div class="about-version">Version <span id="about-version">0.0.0</span></div>
          </div>
        </div>
        <button class="about-close" id="about-close">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>

      <div class="about-content">
        <div class="about-section">
          <div class="about-section-title">What is Vitamin?</div>
          <p class="about-text">
            Vitamin is an open-source privacy-focused browser that protects your online identity through <strong>data pollution</strong>.
            Instead of just blocking trackers, Vitamin generates synthetic browsing activity that makes your real data
            unreliable for profiling and tracking purposes. Completely free to use.
          </p>
        </div>

        <div class="about-section">
          <div class="about-section-title">How It Works</div>
          <p class="about-text">
            When poisoning is active, Vitamin performs automated searches and visits websites in the background
            based on fictional personas. This creates noise in the data that trackers collect about you,
            making it difficult for advertisers and data brokers to build an accurate profile of your interests
            and behavior. All features are completely free and open source.
          </p>
        </div>

        <div class="about-section">
          <div class="about-section-title">Open Source</div>
          <p class="about-text">
            Vitamin Browser is completely free and open source software released under the GNU General Public License v3.0.
            You can view the source code, contribute improvements, and report issues on our GitHub repository.
          </p>
          <p class="about-text">
            <strong>All features are available to everyone at no cost.</strong> There are no premium tiers or paid subscriptions.
          </p>
        </div>

        <div class="about-section">
          <div class="about-section-title">License</div>
          <p class="about-text">
            This program is free software: you can redistribute it and/or modify
            it under the terms of the GNU General Public License as published by
            the Free Software Foundation, either version 3 of the License, or
            (at your option) any later version.
          </p>
          <p class="about-text">
            This program is distributed in the hope that it will be useful,
            but WITHOUT ANY WARRANTY; without even the implied warranty of
            MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
            GNU General Public License for more details.
          </p>
        </div>
      </div>

      <div class="about-footer">
        <button class="about-replay-btn" id="replay-onboarding-btn">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="5 3 19 12 5 21 5 3"/>
          </svg>
          Replay Onboarding
        </button>
        <p class="about-footer-text">
          Made with care by <a href="#" class="about-footer-link" id="about-vitali-link">Vitali</a>
        </p>
      </div>
    </div>
  </div>

  <script>
    const urlBar = document.getElementById('url-bar');
    const backBtn = document.getElementById('back-btn');
    const forwardBtn = document.getElementById('forward-btn');
    const refreshBtn = document.getElementById('refresh-btn');
    const poisonBtn = document.getElementById('poison-btn');
    const poisonLabel = document.getElementById('poison-label');
    const activityList = document.getElementById('activity-list');
    const totalActions = document.getElementById('total-actions');
    const totalSearches = document.getElementById('total-searches');
    const totalVisits = document.getElementById('total-visits');
    let isPoisoning = false;

    // Window Controls (Linux & Windows - macOS uses native traffic lights)
    (async () => {
      const platform = await window.vitamin.getPlatform();
      if (platform !== 'darwin') {
        const windowControls = document.getElementById('window-controls');
        windowControls.classList.add('non-mac');

        document.getElementById('minimize-btn').addEventListener('click', () => {
          window.vitamin.windowMinimize();
        });
        document.getElementById('maximize-btn').addEventListener('click', () => {
          window.vitamin.windowMaximize();
        });
        document.getElementById('close-btn').addEventListener('click', () => {
          window.vitamin.windowClose();
        });
      }
    })();

    // Navigation
    urlBar.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        window.vitamin.navigate(urlBar.value);
      }
    });

    // Select all URL on focus for easy replacement
    urlBar.addEventListener('focus', () => {
      setTimeout(() => urlBar.select(), 0);
    });

    const homeBtn = document.getElementById('home-btn');
    const tabBar = document.getElementById('tab-bar');
    const newTabBtn = document.getElementById('new-tab-btn');
    const closeTabBtn = document.getElementById('close-tab-btn');

    backBtn.addEventListener('click', () => window.vitamin.goBack());
    forwardBtn.addEventListener('click', () => window.vitamin.goForward());
    refreshBtn.addEventListener('click', () => window.vitamin.refresh());
    homeBtn.addEventListener('click', () => window.vitamin.goHome());

    // Tab management
    let currentActiveTabId = null;
    newTabBtn.addEventListener('click', () => window.vitamin.createTab());
    closeTabBtn.addEventListener('click', () => {
      if (currentActiveTabId !== null) {
        window.vitamin.closeTab(currentActiveTabId);
      }
    });

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function renderTabs(data) {
      currentActiveTabId = data.activeTabId;

      // Clear existing tabs (keep control buttons and divider)
      const existingTabs = tabBar.querySelectorAll('.tab');
      existingTabs.forEach(t => t.remove());

      // Adjust tab styling based on number of tabs
      const tabContainer = document.querySelector('.tab-container');
      if (data.tabs.length > 4) {
        // Add compact class for more than 4 tabs
        tabContainer.classList.add('compact');
      } else {
        // Remove compact class for 4 or fewer tabs
        tabContainer.classList.remove('compact');
      }

      // Render tabs
      data.tabs.forEach(tab => {
        const tabEl = document.createElement('div');
        tabEl.className = `tab ${tab.id === data.activeTabId ? 'active' : ''}`;
        tabEl.dataset.tabId = tab.id;
        tabEl.title = tab.title || 'New Tab';

        // Favicon
        const faviconHtml = tab.favicon
          ? `<img class="tab-favicon" src="${escapeHtml(tab.favicon)}" onerror="this.outerHTML='<div class=\\'tab-favicon-placeholder\\'></div>'">`
          : `<div class="tab-favicon-placeholder"></div>`;

        const title = tab.title || 'New Tab';

        tabEl.innerHTML = `
          ${faviconHtml}
          <span class="tab-title">${escapeHtml(title)}</span>
        `;

        // Click tab to switch
        tabEl.addEventListener('click', () => {
          window.vitamin.switchTab(tab.id);
        });

        // Right-click tab context menu
        tabEl.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          showTabContextMenu(tab.id, e.clientX, e.clientY);
        });

        tabBar.appendChild(tabEl);
      });

      // Scroll active tab into view
      const activeTab = tabBar.querySelector('.tab.active');
      if (activeTab) {
        activeTab.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'nearest' });
      }
    }

    // Tab context menu
    function showTabContextMenu(tabId, x, y) {
      // Remove any existing context menu
      const existingMenu = document.getElementById('tab-context-menu');
      if (existingMenu) existingMenu.remove();

      // Create context menu
      const menu = document.createElement('div');
      menu.id = 'tab-context-menu';
      menu.className = 'context-menu';
      menu.style.position = 'fixed';
      menu.style.left = `${x}px`;
      menu.style.top = `${y}px`;
      menu.style.zIndex = '10000';

      // Get tab data
      const tabData = window.currentTabsData ? window.currentTabsData.tabs.find(t => t.id === tabId) : null;

      // Menu items
      menu.innerHTML = `
        <div class="context-menu-item" data-action="new-tab">
          <span>New Tab</span>
        </div>
        <div class="context-menu-item" data-action="duplicate-tab">
          <span>Duplicate</span>
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="close-tab">
          <span>Close</span>
        </div>
        <div class="context-menu-item" data-action="close-other-tabs">
          <span>Close Other Tabs</span>
        </div>
        <div class="context-menu-item" data-action="close-tabs-to-right">
          <span>Close Tabs to the Right</span>
        </div>
      `;

      // Add to document
      document.body.appendChild(menu);

      // Add event listeners to menu items
      menu.querySelectorAll('.context-menu-item').forEach(item => {
        item.addEventListener('click', () => {
          const action = item.dataset.action;
          switch (action) {
            case 'new-tab':
              window.vitamin.createTab();
              break;
            case 'duplicate-tab':
              // We'll need to implement this in the main process
              window.vitamin.duplicateTab(tabId);
              break;
            case 'close-tab':
              window.vitamin.closeTab(tabId);
              break;
            case 'close-other-tabs':
              // This would need to be implemented in the main process
              window.vitamin.closeOtherTabs(tabId);
              break;
            case 'close-tabs-to-right':
              // This would need to be implemented in the main process
              window.vitamin.closeTabsToRight(tabId);
              break;
          }
          menu.remove();
        });
      });

      // Close menu when clicking elsewhere
      const closeMenu = (e) => {
        if (!menu.contains(e.target)) {
          menu.remove();
          document.removeEventListener('click', closeMenu);
        }
      };
      setTimeout(() => {
        document.addEventListener('click', closeMenu);
      }, 0);

      // Close menu on Escape key
      const handleEscape = (e) => {
        if (e.key === 'Escape') {
          menu.remove();
          document.removeEventListener('keydown', handleEscape);
        }
      };
      document.addEventListener('keydown', handleEscape);
    }

    // Listen for tab updates
    window.vitamin.onTabsUpdate((data) => {
      // Store current tabs data for context menu access
      window.currentTabsData = data;
      renderTabs(data);
    });

    // URL updates
    window.vitamin.onUrlChanged((url) => {
      urlBar.value = url;
    });

    const dashboard = document.querySelector('.dashboard');

    // Show/hide dashboard (poison stats bar)
    function showDashboard() {
      dashboard.classList.add('visible');
      window.vitamin.dashboardShow();
    }

    function hideDashboard() {
      dashboard.classList.remove('visible');
      window.vitamin.dashboardHide();
    }

    // Poison toggle
    poisonBtn.addEventListener('click', (e) => {
      isPoisoning = !isPoisoning;
      window.vitamin.togglePoison(isPoisoning);

      // Store poison state in localStorage for start page to read
      localStorage.setItem('vitamin-poison-active', isPoisoning ? 'true' : 'false');

      if (isPoisoning) {
        poisonBtn.classList.add('active');
        poisonLabel.textContent = 'Active';
        activityList.innerHTML = '';
        showDashboard();
      } else {
        poisonBtn.classList.remove('active');
        poisonLabel.textContent = 'Poison';
        activityList.innerHTML = '<span class="empty-state">Poisoning inactive... Press da button to start!</span>';
        hideDashboard();
      }
    });

    // Show dashboard on hover when poison is active
    let poisonHoverTimeout;
    let dashboardHideTimeout;

    poisonBtn.addEventListener('mouseenter', () => {
      clearTimeout(poisonHoverTimeout);
      poisonBtn.classList.add('hover-persist');
      if (isPoisoning) {
        showDashboard();
      }
    });

    // Hide dashboard and remove hover style when mouse leaves (with delay)
    poisonBtn.addEventListener('mouseleave', () => {
      // Keep hover style for 1 second
      poisonHoverTimeout = setTimeout(() => {
        poisonBtn.classList.remove('hover-persist');
      }, 1000);

      if (isPoisoning) {
        dashboardHideTimeout = setTimeout(() => {
          hideDashboard();
        }, 1000);
      }
    });

    // Keep dashboard open if mouse enters it
    dashboard.addEventListener('mouseenter', () => {
      clearTimeout(dashboardHideTimeout);
      clearTimeout(poisonHoverTimeout);
      poisonBtn.classList.add('hover-persist');
    });

    dashboard.addEventListener('mouseleave', () => {
      // Delay removing hover style when leaving dashboard
      poisonHoverTimeout = setTimeout(() => {
        poisonBtn.classList.remove('hover-persist');
      }, 1000);

      if (isPoisoning) {
        hideDashboard();
      }
    });

    // Helper to escape HTML
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Activity updates
    window.vitamin.onPoisonActivity((activity) => {
      // Flash the status dot
      const statusDot = poisonBtn.querySelector('.status-dot');
      statusDot.classList.remove('flash');
      // Force reflow to restart animation
      void statusDot.offsetWidth;
      statusDot.classList.add('flash');

      // Remove empty state if present
      const emptyState = activityList.querySelector('.empty-state');
      if (emptyState) emptyState.remove();

      let text = '';
      if (activity.type === 'search') {
        text = activity.query;
      } else {
        try {
          const url = new URL(activity.url);
          text = url.hostname.replace('www.', '');
        } catch {
          text = activity.url.slice(0, 25);
        }
      }

      // Add to dashboard activity list
      const item = document.createElement('div');
      item.className = `activity-item ${activity.type}`;
      item.textContent = text;
      activityList.insertBefore(item, activityList.firstChild);
      while (activityList.children.length > 4) {
        activityList.removeChild(activityList.lastChild);
      }
    });

    // Stats updates
    window.vitamin.onPoisonStats((stats) => {
      totalActions.textContent = stats.totalActions;
      totalSearches.textContent = stats.searches;
      totalVisits.textContent = stats.visits;
    });

    // Settings Panel
    const settingsBtn = document.getElementById('settings-btn');
    const settingsPanel = document.getElementById('settings-panel');
    const settingsOverlay = document.getElementById('settings-overlay');
    const settingsClose = document.getElementById('settings-close');
    const frequencySelector = document.getElementById('frequency-selector');
    const frequencyWarning = document.getElementById('frequency-warning');
    const frequencyWarningText = document.getElementById('frequency-warning-text');
    const personaSection = document.getElementById('persona-section');
    const personaSelect = document.getElementById('persona-select');
    const adblockToggle = document.getElementById('adblock-toggle');
    const blockedCount = document.getElementById('blocked-count');
    const autoUpdateToggle = document.getElementById('auto-update-toggle');

    let currentFrequency = 'medium';
    let currentPersona = null;
    let adBlockEnabled = true;
    let autoUpdateEnabled = true;
    let availablePersonas = []; // Store available personas for lookup

    let settingsOpen = false;

    // Frequency warnings
    const frequencyWarnings = {
      low: null,
      medium: null,
      high: 'Some sites may rate-limit or temporarily block you.',
      max: 'High risk of rate-limiting or bans from some websites. Use with caution.'
    };

    // Function to update persona display in dashboard
    function updatePersonaDisplay() {
      const personaNameElement = document.getElementById('current-persona');
      const freqNameElement = document.getElementById('current-tier');

      // Update frequency display
      const freqNames = {
        'low': 'Chill',
        'medium': 'Standard',
        'high': 'Aggressive',
        'max': 'Overdose'
      };
      freqNameElement.textContent = freqNames[currentFrequency] || currentFrequency;

      // Update persona display
      if (currentPersona) {
        // Find the persona name from available personas
        const persona = availablePersonas.find(p => p.id === currentPersona);
        if (persona) {
          personaNameElement.textContent = persona.name;
        } else {
          personaNameElement.textContent = currentPersona;
        }
      } else {
        personaNameElement.textContent = 'No Persona Selected';
      }
    }

    function openSettings() {
      // Close any open left panels first
      const anyLeftOpen = document.querySelector('.left-panel.open');
      document.querySelectorAll('.left-panel').forEach(p => p.classList.remove('open'));
      if (anyLeftOpen) {
        window.vitamin.leftPanelClose();
      }
      settingsOpen = true;
      settingsPanel.classList.add('open');
      settingsOverlay.classList.add('open');
      window.vitamin.settingsOpen();
    }

    function closeSettings() {
      settingsOpen = false;
      settingsPanel.classList.remove('open');
      settingsOverlay.classList.remove('open');
      window.vitamin.settingsClose();
    }

    function toggleSettings() {
      if (settingsOpen) {
        closeSettings();
      } else {
        openSettings();
      }
    }

    settingsBtn.addEventListener('click', toggleSettings);
    settingsClose.addEventListener('click', closeSettings);
    settingsOverlay.addEventListener('click', closeSettings);

    // Close settings when clicking anywhere outside the panel
    document.addEventListener('click', (e) => {
      if (!settingsOpen) return;
      // Check if click is outside settings panel and not on settings button
      if (!settingsPanel.contains(e.target) && !settingsBtn.contains(e.target)) {
        closeSettings();
      }
    });

    // Frequency selection
    frequencySelector.addEventListener('click', async (e) => {
      const btn = e.target.closest('.freq-btn');
      if (!btn) return;

      const frequency = btn.dataset.frequency;
      currentFrequency = frequency;

      // Update UI
      frequencySelector.querySelectorAll('.freq-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');

      // Show/hide warning
      const warning = frequencyWarnings[frequency];
      if (warning) {
        frequencyWarningText.textContent = warning;
        frequencyWarning.style.display = 'block';
      } else {
        frequencyWarning.style.display = 'none';
      }

      // Send to main process
      window.vitamin.setFrequency(frequency);

      // Update dashboard display
      updatePersonaDisplay();
    });

    // Persona selection
    personaSelect.addEventListener('change', (e) => {
      currentPersona = e.target.value || null;
      window.vitamin.setPersona(currentPersona);
      updatePersonaDisplay(); // Update dashboard display
    });

    // Ad block toggle
    adblockToggle.addEventListener('click', () => {
      adBlockEnabled = !adBlockEnabled;
      adblockToggle.classList.toggle('on', adBlockEnabled);
      window.vitamin.toggleAdBlock(adBlockEnabled);
    });

    // Auto-update toggle
    autoUpdateToggle.addEventListener('click', () => {
      autoUpdateEnabled = !autoUpdateEnabled;
      autoUpdateToggle.classList.toggle('on', autoUpdateEnabled);
      window.vitamin.toggleAutoUpdate(autoUpdateEnabled);
    });

    // Blocked count updates
    window.vitamin.onBlockedCount((count) => {
      blockedCount.textContent = count;
    });

    // Load all personas
    async function loadPersonas() {
      // Clear existing options except the placeholder
      personaSelect.innerHTML = '<option value="">Select a persona...</option>';

      // Load all personas
      const personas = await window.vitamin.getPersonas();
      availablePersonas = personas; // Store for lookup

      personas.forEach(p => {
        const option = document.createElement('option');
        option.value = p.id;
        if (p.isCustom) {
          option.textContent = `${p.name} (Custom)`;
        } else {
          option.textContent = `${p.name} - ${p.description}`;
        }
        personaSelect.appendChild(option);
      });

      // Update dashboard display
      updatePersonaDisplay();
    }

    // Load personas and initial settings
    async function initSettings() {
      // Load settings first
      const settings = await window.vitamin.getSettings();
      if (settings) {
        currentFrequency = settings.frequency || 'medium';
        currentPersona = settings.persona;
        adBlockEnabled = settings.adBlockEnabled !== false;

        // Update frequency UI
        frequencySelector.querySelectorAll('.freq-btn').forEach(b => {
          b.classList.toggle('selected', b.dataset.frequency === currentFrequency);
        });

        // Show warning if needed
        const warning = frequencyWarnings[currentFrequency];
        if (warning) {
          frequencyWarningText.textContent = warning;
          frequencyWarning.style.display = 'block';
        }

        // Always show persona section (all features free)
        personaSection.style.display = 'block';

        // Load all personas
        await loadPersonas();
        if (currentPersona) {
          personaSelect.value = currentPersona;
        }

        // Update adblock UI
        adblockToggle.classList.toggle('on', adBlockEnabled);

        // Update auto-update UI
        autoUpdateEnabled = settings.autoUpdate !== false;
        autoUpdateToggle.classList.toggle('on', autoUpdateEnabled);

        // Apply performance mode if enabled
        if (settings.performanceMode) {
          performanceModeEnabled = true;
          performanceModeToggle.classList.add('on');
          performanceModeInfo.style.display = 'block';
          performanceDetailsBtn.style.display = 'block';
          document.body.classList.add('performance-mode');
        }
      }
    }

    // initSettings is called via initSettingsExtended below

    // Update dashboard display after initial load
    setTimeout(updatePersonaDisplay, 100);

    // Check for updates button
    const checkUpdateBtn = document.getElementById('check-update-btn');
    let updateCheckTimeout = null;

    function resetUpdateBtn() {
      if (updateCheckTimeout) clearTimeout(updateCheckTimeout);
      updateCheckTimeout = setTimeout(() => {
        checkUpdateBtn.textContent = 'Check for Updates';
        checkUpdateBtn.disabled = false;
      }, 5000);
    }

    checkUpdateBtn.addEventListener('click', async () => {
      checkUpdateBtn.textContent = 'Checking...';
      checkUpdateBtn.disabled = true;
      await window.vitamin.checkForUpdates();
    });

    // Update event listeners
    window.vitamin.onUpdateChecking(() => {
      checkUpdateBtn.textContent = 'Checking...';
      checkUpdateBtn.disabled = true;
    });

    window.vitamin.onUpdateAvailable((version) => {
      checkUpdateBtn.textContent = `Downloading v${version}...`;
    });

    window.vitamin.onUpdateNotAvailable(() => {
      checkUpdateBtn.textContent = 'Up to date!';
      resetUpdateBtn();
    });

    window.vitamin.onUpdateDownloadProgress((percent) => {
      checkUpdateBtn.textContent = `Downloading... ${percent}%`;
    });

    window.vitamin.onUpdateError((message) => {
      checkUpdateBtn.textContent = 'Update failed';
      console.error('Update error:', message);
      resetUpdateBtn();
    });

    // Load app version
    async function loadAppVersion() {
      try {
        const version = await window.vitamin.getAppVersion();
        document.getElementById('app-version').textContent = version;
      } catch (err) {
        console.error('Failed to load version:', err);
      }
    }
    loadAppVersion();

    // Handle onboarding completion if needed
    window.vitamin.onOnboardingCompleted(() => {
      // Any actions needed after onboarding completion can be added here
      console.log('Onboarding completed');
    });

    // What's New Modal
    const whatsNewModal = document.getElementById('whats-new-modal');
    const whatsNewVersion = document.getElementById('whats-new-version');
    const whatsNewList = document.getElementById('whats-new-list');
    const whatsNewDismiss = document.getElementById('whats-new-dismiss');

    function showWhatsNew(version, notes) {
      whatsNewVersion.textContent = version;
      whatsNewList.innerHTML = notes.map(note => `<li>${note}</li>`).join('');
      whatsNewModal.classList.add('open');
      window.vitamin.modalOpen(); // Hide BrowserView so modal is visible
    }

    function hideWhatsNew() {
      whatsNewModal.classList.remove('open');
      window.vitamin.modalClose(); // Restore BrowserView
      window.vitamin.markVersionSeen();
    }

    whatsNewDismiss.addEventListener('click', hideWhatsNew);
    whatsNewModal.addEventListener('click', (e) => {
      if (e.target === whatsNewModal) hideWhatsNew();
    });

    // Listen for "What's New" event from main process
    window.vitamin.onShowWhatsNew((data) => {
      showWhatsNew(data.version, data.notes);
    });

    // Update Banner
    const updateBanner = document.getElementById('update-banner');
    const updateVersion = document.getElementById('update-version');
    const updateInstallBtn = document.getElementById('update-install-btn');
    const updateDismissBtn = document.getElementById('update-dismiss-btn');

    window.vitamin.onUpdateDownloaded((version) => {
      updateVersion.textContent = version;
      updateBanner.classList.add('show');
    });

    updateInstallBtn.addEventListener('click', () => {
      // Show full update overlay
      updateBanner.innerHTML = `
        <div style="display: flex; align-items: center; gap: 12px;">
          <div style="width: 18px; height: 18px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite;"></div>
          <span class="update-text">Installing update... Please wait, app will restart automatically</span>
        </div>
      `;
      window.vitamin.installUpdate();
    });

    updateDismissBtn.addEventListener('click', () => {
      updateBanner.classList.remove('show');
    });

    // Progress bar
    const progressBar = document.getElementById('progress-bar');
    let progressInterval = null;
    let currentProgress = 0;

    window.vitamin.onLoadingStart(() => {
      currentProgress = 0;
      progressBar.style.width = '0%';
      progressBar.classList.remove('complete');
      progressBar.classList.add('loading');

      // Animate progress (fake but smooth)
      progressInterval = setInterval(() => {
        if (currentProgress < 90) {
          currentProgress += Math.random() * 15;
          if (currentProgress > 90) currentProgress = 90;
          progressBar.style.width = currentProgress + '%';
        }
      }, 200);
    });

    window.vitamin.onLoadingStop(() => {
      if (progressInterval) {
        clearInterval(progressInterval);
        progressInterval = null;
      }
      progressBar.style.width = '100%';
      progressBar.classList.remove('loading');
      progressBar.classList.add('complete');

      setTimeout(() => {
        progressBar.classList.remove('complete');
        progressBar.style.width = '0%';
      }, 500);
    });

    // Platform detection - adjust padding for Linux (no traffic lights)
    async function initPlatform() {
      const platform = await window.vitamin.getPlatform();

      if (platform === 'linux') {
        // Adjust toolbar padding (no macOS traffic lights)
        document.querySelector('.toolbar').style.paddingLeft = '16px';
        document.querySelector('.dashboard').style.paddingLeft = '16px';
      }
    }
    initPlatform();

    // ===== Panel Management =====
    let currentUrl = '';
    let currentTitle = '';
    let currentFavicon = '';

    function closeAllPanels() {
      // Close left panels
      const anyLeftOpen = document.querySelector('.left-panel.open');
      document.querySelectorAll('.left-panel').forEach(p => p.classList.remove('open'));
      if (anyLeftOpen) {
        window.vitamin.leftPanelClose();
      }
      // Close settings panel
      if (settingsOpen) {
        settingsOpen = false;
        settingsPanel.classList.remove('open');
        settingsOverlay.classList.remove('open');
        window.vitamin.settingsClose();
      }
    }

    // Track current tab info
    window.vitamin.onTabsUpdate((data) => {
      const activeTab = data.tabs.find(t => t.id === data.activeTabId);
      if (activeTab) {
        currentTitle = activeTab.title;
        currentFavicon = activeTab.favicon || '';
      }
    });

    window.vitamin.onUrlChanged((url) => {
      currentUrl = url;
      updateBookmarkBtnState();
    });

    async function updateBookmarkBtnState() {
      const bookmarkBtn = document.getElementById('bookmark-btn');
      if (currentUrl && !currentUrl.startsWith('file://')) {
        const isBookmarked = await window.vitamin.isBookmarked(currentUrl);
        bookmarkBtn.classList.toggle('active', isBookmarked);
      } else {
        bookmarkBtn.classList.remove('active');
      }
    }

    // ===== Bookmarks Panel =====
    const bookmarkBtn = document.getElementById('bookmark-btn');
    const bookmarksPanel = document.getElementById('bookmarks-panel');
    const bookmarksList = document.getElementById('bookmarks-list');
    const addBookmarkBtn = document.getElementById('add-bookmark-btn');

    bookmarkBtn.addEventListener('click', async () => {
      if (bookmarksPanel.classList.contains('open')) {
        bookmarksPanel.classList.remove('open');
        window.vitamin.leftPanelClose();
        return;
      }
      closeAllPanels();
      bookmarksPanel.classList.add('open');
      window.vitamin.leftPanelOpen();
      await renderBookmarks();
    });

    document.getElementById('bookmarks-panel-close').addEventListener('click', () => {
      bookmarksPanel.classList.remove('open');
      window.vitamin.leftPanelClose();
    });

    addBookmarkBtn.addEventListener('click', async () => {
      if (currentUrl && !currentUrl.startsWith('file://')) {
        await window.vitamin.addBookmark({
          url: currentUrl,
          title: currentTitle || currentUrl,
          favicon: currentFavicon
        });
        await renderBookmarks();
        updateBookmarkBtnState();
      }
    });

    async function renderBookmarks() {
      const bookmarks = await window.vitamin.getBookmarks();
      if (bookmarks.length === 0) {
        bookmarksList.innerHTML = '<div class="panel-empty">No bookmarks yet (à²¥ï¹à²¥) Save some pages and they\'ll appear here!</div>';
        return;
      }

      bookmarksList.innerHTML = bookmarks.map(b => `
        <div class="panel-item" data-url="${escapeHtml(b.url)}" data-title="${escapeHtml(b.title)}">
          ${b.favicon ? `<img class="panel-item-icon" src="${escapeHtml(b.favicon)}" onerror="this.className='panel-item-icon-placeholder'">` : '<div class="panel-item-icon-placeholder"></div>'}
          <div class="panel-item-content">
            <div class="panel-item-title">${escapeHtml(b.title)}</div>
            <div class="panel-item-subtitle">${escapeHtml(b.url)}</div>
          </div>
          <button class="panel-item-edit" data-url="${escapeHtml(b.url)}" data-title="${escapeHtml(b.title)}" title="Edit">
            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
          </button>
          <button class="panel-item-remove" data-url="${escapeHtml(b.url)}" title="Remove">
            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
      `).join('');

      bookmarksList.querySelectorAll('.panel-item').forEach(item => {
        item.addEventListener('click', (e) => {
          if (!e.target.closest('.panel-item-remove') && !e.target.closest('.panel-item-edit')) {
            window.vitamin.navigate(item.dataset.url);
            bookmarksPanel.classList.remove('open');
            window.vitamin.leftPanelClose();
          }
        });
      });

      // Edit bookmark
      bookmarksList.querySelectorAll('.panel-item-edit').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const oldUrl = btn.dataset.url;
          const oldTitle = btn.dataset.title;
          showBookmarkEditModal(oldUrl, oldTitle);
        });
      });

      bookmarksList.querySelectorAll('.panel-item-remove').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          await window.vitamin.removeBookmark(btn.dataset.url);
          await renderBookmarks();
          updateBookmarkBtnState();
        });
      });
    }

    // Bookmark edit modal
    function showBookmarkEditModal(oldUrl, oldTitle) {
      const modal = document.createElement('div');
      modal.className = 'bookmark-edit-overlay';
      modal.innerHTML = `
        <div class="bookmark-edit-modal">
          <div class="bookmark-edit-header">Edit Bookmark</div>
          <div class="bookmark-edit-field">
            <label>Name</label>
            <input type="text" id="bookmark-edit-title">
          </div>
          <div class="bookmark-edit-field">
            <label>URL</label>
            <input type="text" id="bookmark-edit-url">
          </div>
          <div class="bookmark-edit-actions">
            <button class="bookmark-edit-cancel">Cancel</button>
            <button class="bookmark-edit-save">Save</button>
          </div>
        </div>
      `;
      document.body.appendChild(modal);

      // Hide BrowserView so modal is visible
      window.vitamin.modalOpen();

      const titleInput = modal.querySelector('#bookmark-edit-title');
      const urlInput = modal.querySelector('#bookmark-edit-url');

      // Set values programmatically to avoid escaping issues
      titleInput.value = oldTitle;
      urlInput.value = oldUrl;

      titleInput.focus();
      titleInput.select();

      function closeModal() {
        modal.remove();
        window.vitamin.modalClose();
      }

      modal.querySelector('.bookmark-edit-cancel').addEventListener('click', closeModal);

      modal.querySelector('.bookmark-edit-save').addEventListener('click', async () => {
        const newTitle = titleInput.value.trim();
        const newUrl = urlInput.value.trim();
        if (newTitle && newUrl) {
          await window.vitamin.updateBookmark({ oldUrl, newUrl, title: newTitle });
          await renderBookmarks();
          updateBookmarkBtnState();
        }
        closeModal();
      });

      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    // ===== Downloads Panel =====
    const downloadsBtn = document.getElementById('downloads-btn');
    const downloadsPanel = document.getElementById('downloads-panel');
    const downloadsList = document.getElementById('downloads-list');
    const downloadsBadge = document.getElementById('downloads-badge');
    const clearDownloadsBtn = document.getElementById('clear-downloads-btn');
    let downloads = [];

    downloadsBtn.addEventListener('click', async () => {
      if (downloadsPanel.classList.contains('open')) {
        downloadsPanel.classList.remove('open');
        window.vitamin.leftPanelClose();
        return;
      }
      closeAllPanels();
      downloadsPanel.classList.add('open');
      window.vitamin.leftPanelOpen();
      downloads = await window.vitamin.getDownloads();
      renderDownloads();
    });

    document.getElementById('downloads-panel-close').addEventListener('click', () => {
      downloadsPanel.classList.remove('open');
      window.vitamin.leftPanelClose();
    });

    clearDownloadsBtn.addEventListener('click', async () => {
      downloads = await window.vitamin.clearDownloads();
      renderDownloads();
    });

    function renderDownloads() {
      if (downloads.length === 0) {
        downloadsList.innerHTML = '<div class="panel-empty">No downloads yet (à²¥ï¹à²¥) Files you download will appear here!</div>';
        return;
      }

      downloadsList.innerHTML = downloads.map(d => {
        const progress = d.totalBytes > 0 ? Math.round((d.receivedBytes / d.totalBytes) * 100) : 0;
        const isCompleted = d.state === 'completed';
        const statusText = isCompleted ? 'Completed' : (d.state === 'progressing' ? `${progress}%` : d.state);

        return `
          <div class="panel-item" data-path="${escapeHtml(d.savePath || '')}">
            <div class="panel-item-icon-placeholder" style="display:flex;align-items:center;justify-content:center;">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              </svg>
            </div>
            <div class="panel-item-content">
              <div class="panel-item-title">${escapeHtml(d.filename)}</div>
              ${!isCompleted ? `<div class="download-progress"><div class="download-progress-bar" style="width: ${progress}%"></div></div>` : ''}
              <div class="panel-item-status ${isCompleted ? 'completed' : ''}">${statusText}</div>
            </div>
          </div>
        `;
      }).join('');

      downloadsList.querySelectorAll('.panel-item').forEach(item => {
        item.addEventListener('click', () => {
          const path = item.dataset.path;
          if (path) window.vitamin.openDownload(path);
        });
      });
    }

    window.vitamin.onDownloadUpdated((download) => {
      const idx = downloads.findIndex(d => d.id === download.id);
      if (idx >= 0) downloads[idx] = download;
      else downloads.unshift(download);
      const activeDownloads = downloads.filter(d => d.state === 'progressing').length;
      downloadsBadge.classList.toggle('show', activeDownloads > 0);
      if (downloadsPanel.classList.contains('open')) renderDownloads();
    });

    window.vitamin.onDownloadDone((download) => {
      const idx = downloads.findIndex(d => d.id === download.id);
      if (idx >= 0) downloads[idx] = download;
      const activeDownloads = downloads.filter(d => d.state === 'progressing').length;
      downloadsBadge.classList.toggle('show', activeDownloads > 0);
      if (downloadsPanel.classList.contains('open')) renderDownloads();
    });

    // ===== History Panel =====
    const viewHistoryBtn = document.getElementById('view-history-btn');
    const historyPanel = document.getElementById('history-panel');
    const historyList = document.getElementById('history-list');
    const shredHistoryPanelBtn = document.getElementById('shred-history-panel-btn');

    viewHistoryBtn.addEventListener('click', async () => {
      // Close settings panel first
      settingsPanel.classList.remove('open');
      window.vitamin.settingsClose();

      closeAllPanels();
      historyPanel.classList.add('open');
      window.vitamin.leftPanelOpen();
      await renderHistory();
    });

    document.getElementById('history-panel-close').addEventListener('click', () => {
      historyPanel.classList.remove('open');
      window.vitamin.leftPanelClose();
    });

    shredHistoryPanelBtn.addEventListener('click', async () => {
      if (confirm('Delete all browsing history?')) {
        await window.vitamin.shredHistory();
        await renderHistory();
      }
    });

    async function renderHistory() {
      const history = await window.vitamin.getHistory();
      if (history.length === 0) {
        historyList.innerHTML = '<div class="panel-empty">No history yet (à²¥ï¹à²¥) Pages you visit will appear here!</div>';
        return;
      }

      historyList.innerHTML = history.slice(0, 100).map(h => {
        const date = new Date(h.timestamp);
        const timeStr = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        return `
          <div class="panel-item" data-url="${escapeHtml(h.url)}">
            <div class="panel-item-icon-placeholder"></div>
            <div class="panel-item-content">
              <div class="panel-item-title">${escapeHtml(h.title)}</div>
              <div class="panel-item-subtitle">${timeStr} - ${escapeHtml(h.url)}</div>
            </div>
          </div>
        `;
      }).join('');

      historyList.querySelectorAll('.panel-item').forEach(item => {
        item.addEventListener('click', () => {
          window.vitamin.navigate(item.dataset.url);
          historyPanel.classList.remove('open');
          window.vitamin.leftPanelClose();
        });
      });
    }

    // ===== Cookies Panel =====
    const cookiesPanel = document.getElementById('cookies-panel');
    const cookiesList = document.getElementById('cookies-list');
    const viewCookiesBtn = document.getElementById('view-cookies-btn');
    const shredCookiesPanelBtn = document.getElementById('shred-cookies-panel-btn');
    const cookieCountEl = document.getElementById('cookie-count');

    viewCookiesBtn.addEventListener('click', async () => {
      closeAllPanels();
      settingsPanel.classList.remove('open');
      settingsOverlay.classList.remove('open');
      cookiesPanel.classList.add('open');
      window.vitamin.leftPanelOpen();
      await renderCookies();
    });

    document.getElementById('cookies-panel-close').addEventListener('click', () => {
      cookiesPanel.classList.remove('open');
      window.vitamin.leftPanelClose();
    });

    shredCookiesPanelBtn.addEventListener('click', async () => {
      if (confirm('Delete all cookies? You will be logged out of all sites.')) {
        await window.vitamin.shredCookies();
        await renderCookies();
        updateCookieCount();
      }
    });

    // Nuke button setup - must wait for DOM since modals are after this script
    document.addEventListener('DOMContentLoaded', () => {
      const nukeBtn = document.getElementById('nuke-btn');
      const nukeModal = document.getElementById('nuke-modal');
      const nukeProgressModal = document.getElementById('nuke-progress-modal');
      const nukeCancel = document.getElementById('nuke-cancel');
      const nukeConfirm = document.getElementById('nuke-confirm');
      const nukeStatus = document.getElementById('nuke-status');
      const nukeProgressFill = document.getElementById('nuke-progress-fill');
      let isNuking = false;

      if (!nukeBtn || !nukeModal) return;

      nukeBtn.addEventListener('click', () => {
        if (isNuking) return;
        window.vitamin.modalOpen();
        nukeModal.style.display = 'flex';
      });

      nukeCancel.addEventListener('click', () => {
        nukeModal.style.display = 'none';
        window.vitamin.modalClose();
      });

      nukeConfirm.addEventListener('click', async () => {
        if (!window.vitamin.nukeBrowserData) return;
        isNuking = true;
        nukeModal.style.display = 'none';

        if (nukeStatus) {
          nukeStatus.textContent = 'Shredding all data (3-pass overwrite)...';
          nukeStatus.style.color = 'var(--text-secondary)';
        }
        if (nukeProgressFill) nukeProgressFill.style.width = '0%';
        nukeProgressModal.style.display = 'flex';

        let progress = 0;
        const progressInterval = setInterval(() => {
          progress += 5;
          if (nukeProgressFill) nukeProgressFill.style.width = `${Math.min(progress, 90)}%`;
        }, 100);

        try {
          const result = await window.vitamin.nukeBrowserData();
          clearInterval(progressInterval);
          if (nukeProgressFill) nukeProgressFill.style.width = '100%';

          if (result && result.success) {
            if (nukeStatus) {
              nukeStatus.textContent = 'COMPLETE - All data securely shredded!';
              nukeStatus.style.color = '#2ed573';
            }
            setTimeout(() => window.vitamin.closeBrowser(), 2000);
          } else {
            throw new Error(result?.error || 'Unknown error');
          }
        } catch (error) {
          clearInterval(progressInterval);
          if (nukeStatus) {
            nukeStatus.textContent = 'Error: ' + (error.message || 'Unknown error');
            nukeStatus.style.color = '#ff4757';
          }
          setTimeout(() => {
            nukeProgressModal.style.display = 'none';
            window.vitamin.modalClose();
            isNuking = false;
          }, 3000);
        }
      });
    });

    async function renderCookies() {
      const cookies = await window.vitamin.getCookies();
      if (cookies.length === 0) {
        cookiesList.innerHTML = '<div class="panel-empty">No cookies yet (à²¥ï¹à²¥) Sites you visit will store cookies here!</div>';
        return;
      }

      // Group by domain
      const grouped = {};
      cookies.forEach(c => {
        const domain = c.domain.replace(/^\./, '');
        if (!grouped[domain]) grouped[domain] = [];
        grouped[domain].push(c);
      });

      cookiesList.innerHTML = Object.entries(grouped).map(([domain, domainCookies]) => `
        <div class="cookie-domain" data-domain="${escapeHtml(domain)}">
          <div class="cookie-domain-header">
            <img class="panel-item-icon" src="https://www.google.com/s2/favicons?domain=${encodeURIComponent(domain)}&sz=32" onerror="this.className='panel-item-icon-placeholder'">
            <div class="panel-item-content">
              <div class="panel-item-title">${escapeHtml(domain)}</div>
              <div class="panel-item-subtitle">${domainCookies.length} cookie${domainCookies.length > 1 ? 's' : ''}</div>
            </div>
            <svg class="cookie-expand-icon" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </div>
          <div class="cookie-details">
            ${domainCookies.map(c => `
              <div class="cookie-item">
                <div class="cookie-name">${escapeHtml(c.name)}</div>
                <div class="cookie-value">${escapeHtml(c.value.slice(0, 50))}${c.value.length > 50 ? '...' : ''}</div>
              </div>
            `).join('')}
          </div>
        </div>
      `).join('');

      // Toggle expansion
      cookiesList.querySelectorAll('.cookie-domain-header').forEach(header => {
        header.addEventListener('click', () => {
          header.parentElement.classList.toggle('expanded');
        });
      });
    }

    async function updateCookieCount() {
      const cookies = await window.vitamin.getCookies();
      cookieCountEl.textContent = cookies.length;
    }
    updateCookieCount();

    // ===== Find in Page =====
    const findBar = document.getElementById('find-bar');
    const findInput = document.getElementById('find-input');
    const findCount = document.getElementById('find-count');
    const findPrevBtn = document.getElementById('find-prev-btn');
    const findNextBtn = document.getElementById('find-next-btn');
    const findCloseBtn = document.getElementById('find-close-btn');
    let findDebounce = null;

    function openFindBar() {
      findBar.classList.add('open');
      findInput.focus();
      findInput.select();
    }

    function closeFindBar() {
      findBar.classList.remove('open');
      findInput.value = '';
      findCount.textContent = '';
      window.vitamin.stopFind();
    }

    // Listen for Cmd/Ctrl+F from main process
    window.vitamin.onToggleFindBar(() => {
      if (findBar.classList.contains('open')) {
        closeFindBar();
      } else {
        openFindBar();
      }
    });

    findInput.addEventListener('input', () => {
      clearTimeout(findDebounce);
      findDebounce = setTimeout(() => {
        const text = findInput.value;
        if (text) {
          window.vitamin.findInPage(text);
        } else {
          window.vitamin.stopFind();
          findCount.textContent = '';
        }
      }, 150);
    });

    findInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        if (e.shiftKey) {
          window.vitamin.findPrevious();
        } else {
          window.vitamin.findNext();
        }
      } else if (e.key === 'Escape') {
        closeFindBar();
      }
    });

    findNextBtn.addEventListener('click', () => window.vitamin.findNext());
    findPrevBtn.addEventListener('click', () => window.vitamin.findPrevious());
    findCloseBtn.addEventListener('click', closeFindBar);

    window.vitamin.onFoundInPage((result) => {
      if (result.matches > 0) {
        findCount.textContent = `${result.activeMatchOrdinal}/${result.matches}`;
      } else {
        findCount.textContent = 'No matches';
      }
    });

    // ===== Session Restore Toggle =====
    const restoreSessionToggle = document.getElementById('restore-session-toggle');
    let restoreSessionEnabled = true;

    restoreSessionToggle.addEventListener('click', () => {
      restoreSessionEnabled = !restoreSessionEnabled;
      restoreSessionToggle.classList.toggle('on', restoreSessionEnabled);
      window.vitamin.toggleRestoreSession(restoreSessionEnabled);
    });

    // ===== Performance Mode Toggle =====
    const performanceModeToggle = document.getElementById('performance-mode-toggle');
    const performanceModeInfo = document.getElementById('performance-mode-info');
    const performanceDetailsBtn = document.getElementById('performance-details-btn');
    const performanceDetails = document.getElementById('performance-details');
    let performanceModeEnabled = false;

    performanceModeToggle.addEventListener('click', async () => {
      performanceModeEnabled = !performanceModeEnabled;
      performanceModeToggle.classList.toggle('on', performanceModeEnabled);
      performanceModeInfo.style.display = performanceModeEnabled ? 'block' : 'none';
      performanceDetailsBtn.style.display = performanceModeEnabled ? 'block' : 'none';

      // Send to main process
      window.vitamin.togglePerformanceMode(performanceModeEnabled);

      // Sync to localStorage for start.html to pick up
      localStorage.setItem('vitamin-performance-mode', performanceModeEnabled ? 'true' : 'false');

      // Apply performance mode styles immediately
      if (performanceModeEnabled) {
        document.body.classList.add('performance-mode');
      } else {
        document.body.classList.remove('performance-mode');
      }
    });

    // Performance details button
    performanceDetailsBtn.addEventListener('click', async () => {
      if (performanceDetails.style.display === 'none') {
        try {
          const metrics = await window.vitamin.getPerformanceMetrics();

          // Format the detailed performance information
          let detailsText = `System: ${metrics.cpuCount} CPU cores, ${metrics.totalMem} MB RAM, ${metrics.platform}\n`;
          detailsText += `Memory Usage: ${metrics.usedMem} MB (${metrics.memUsagePercent}%)\n`;

          if (metrics.processMemory) {
            detailsText += `Browser Memory: ${metrics.processMemory.workingSetSize} MB (Peak: ${metrics.processMemory.peakWorkingSetSize} MB)\n`;
            if (metrics.processMemory.privateBytes) {
              detailsText += `Private Memory: ${metrics.processMemory.privateBytes} MB\n`;
            }
          }

          detailsText += `CPU Usage: ${metrics.appMetrics.totalCPUUsage}% across ${metrics.appMetrics.processCount} processes\n`;
          detailsText += `Open Tabs: ${metrics.tabCount}\n`;
          detailsText += `Performance Mode: ${metrics.performanceModeEnabled ? 'ON' : 'OFF'}`;

          performanceDetails.textContent = detailsText;
          performanceDetails.style.display = 'block';
          performanceDetailsBtn.innerHTML = '<span>Hide Performance Details</span>';
        } catch (error) {
          console.error('Failed to get performance metrics:', error);
          performanceDetails.textContent = 'Error retrieving performance metrics';
          performanceDetails.style.display = 'block';
        }
      } else {
        performanceDetails.style.display = 'none';
        performanceDetailsBtn.innerHTML = '<span>Show Performance Details</span>';
      }
    });

    // Apply performance mode styles via CSS
    const performanceModeStyles = document.createElement('style');
    performanceModeStyles.textContent = `
      .performance-mode * {
        animation-duration: 0s !important;
        transition-duration: 0s !important;
        scroll-behavior: auto !important;
      }

      .performance-mode .poison-btn {
        transition: none !important;
        animation: none !important;
      }

      .performance-mode .tab {
        transition: none !important;
      }

      .performance-mode .nav-btn,
      .performance-mode .toolbar-btn,
      .performance-mode .settings-btn {
        transition: none !important;
      }

      .performance-mode .toggle-switch::after {
        transition: none !important;
      }
    `;
    document.head.appendChild(performanceModeStyles);

    // ===== Changelog Button =====
    const changelogBtn = document.getElementById('changelog-btn');
    const changelogModal = document.getElementById('changelog-modal');
    const changelogListEl = document.getElementById('changelog-list');
    const changelogDismiss = document.getElementById('changelog-dismiss');

    changelogBtn.addEventListener('click', async () => {
      const changelog = await window.vitamin.getChangelog();

      // Sort versions in descending order and show all
      const versions = Object.keys(changelog).sort().reverse();

      changelogListEl.innerHTML = versions.map(v => `
        <div class="changelog-version">
          <div class="changelog-version-title">v${v}</div>
          <ul class="changelog-version-notes">
            ${changelog[v].map(note => `<li>${note}</li>`).join('')}
          </ul>
        </div>
      `).join('');

      changelogModal.classList.add('open');
      window.vitamin.modalOpen();
    });

    changelogDismiss.addEventListener('click', () => {
      changelogModal.classList.remove('open');
      window.vitamin.modalClose();
    });

    changelogModal.addEventListener('click', (e) => {
      if (e.target === changelogModal) {
        changelogModal.classList.remove('open');
        window.vitamin.modalClose();
      }
    });

    // ===== About Modal =====
    const aboutBtn = document.getElementById('about-btn');
    const aboutModal = document.getElementById('about-modal');
    const aboutClose = document.getElementById('about-close');
    const aboutVersion = document.getElementById('about-version');
    const aboutVitaliLink = document.getElementById('about-vitali-link');

    aboutBtn.addEventListener('click', async () => {
      const version = await window.vitamin.getAppVersion();
      aboutVersion.textContent = version;
      aboutModal.classList.add('open');
      window.vitamin.modalOpen();
    });

    aboutClose.addEventListener('click', () => {
      aboutModal.classList.remove('open');
      window.vitamin.modalClose();
    });

    aboutModal.addEventListener('click', (e) => {
      if (e.target === aboutModal) {
        aboutModal.classList.remove('open');
        window.vitamin.modalClose();
      }
    });

    aboutVitaliLink.addEventListener('click', (e) => {
      e.preventDefault();
      window.vitamin.openExternal('https://discord.gg/Udt3edD4DX');
    });

    // ===== Custom Persona Builder =====
    const buildPersonaBtn = document.getElementById('build-persona-btn');
    const customPersonasList = document.getElementById('custom-personas-list');
    const personaBuilderModal = document.getElementById('persona-builder-modal');
    const personaBuilderClose = document.getElementById('persona-builder-close');
    const personaBuilderCancel = document.getElementById('persona-builder-cancel');
    const personaBuilderSave = document.getElementById('persona-builder-save');
    const personaBuilderDelete = document.getElementById('persona-builder-delete');
    const personaBuilderTitle = document.getElementById('persona-builder-modal-title');
    const personaNameInput = document.getElementById('persona-name-input');
    const personaDescInput = document.getElementById('persona-desc-input');
    const personaSearchesInput = document.getElementById('persona-searches-input');
    const personaSitesInput = document.getElementById('persona-sites-input');

    let editingPersonaId = null;

    function openPersonaBuilder(persona = null) {
      editingPersonaId = persona ? persona.id : null;
      personaBuilderTitle.textContent = persona ? 'Edit Persona' : 'Build Your Own Persona';
      personaBuilderDelete.style.display = persona ? 'block' : 'none';

      if (persona) {
        personaNameInput.value = persona.name || '';
        personaDescInput.value = persona.description || '';
        personaSearchesInput.value = (persona.searches || []).join('\n');
        personaSitesInput.value = (persona.sites || []).join('\n');
      } else {
        personaNameInput.value = '';
        personaDescInput.value = '';
        personaSearchesInput.value = '';
        personaSitesInput.value = '';
      }

      personaBuilderModal.classList.add('open');
      window.vitamin.modalOpen();
    }

    function closePersonaBuilder() {
      personaBuilderModal.classList.remove('open');
      window.vitamin.modalClose();
      editingPersonaId = null;
    }

    buildPersonaBtn.addEventListener('click', () => openPersonaBuilder());
    personaBuilderClose.addEventListener('click', closePersonaBuilder);
    personaBuilderCancel.addEventListener('click', closePersonaBuilder);
    personaBuilderModal.addEventListener('click', (e) => {
      if (e.target === personaBuilderModal) closePersonaBuilder();
    });

    personaBuilderSave.addEventListener('click', async () => {
      const name = personaNameInput.value.trim();
      const description = personaDescInput.value.trim();
      const searches = personaSearchesInput.value.split('\n').map(s => s.trim()).filter(s => s);
      const sites = personaSitesInput.value.split('\n').map(s => s.trim()).filter(s => s);

      if (!name) {
        alert('Please enter a persona name');
        return;
      }
      if (searches.length < 3) {
        alert('Please enter at least 3 search terms');
        return;
      }
      if (sites.length < 3) {
        alert('Please enter at least 3 websites');
        return;
      }

      const persona = {
        id: editingPersonaId || null,
        name,
        description,
        searches,
        sites
      };

      const result = await window.vitamin.saveCustomPersona(persona);
      if (result.success) {
        closePersonaBuilder();
        await loadPersonas();
        await renderCustomPersonasList();
      } else {
        alert(result.error || 'Failed to save persona');
      }
    });

    personaBuilderDelete.addEventListener('click', async () => {
      if (!editingPersonaId) return;
      if (!confirm('Delete this custom persona?')) return;

      const result = await window.vitamin.deleteCustomPersona(editingPersonaId);
      if (result.success) {
        closePersonaBuilder();
        await loadPersonas();
        await renderCustomPersonasList();
        // Reset selection if we deleted the selected persona
        if (currentPersona === `custom_${editingPersonaId}`) {
          personaSelect.value = '';
          currentPersona = null;
          window.vitamin.setPersona(null);
        }
      } else {
        alert(result.error || 'Failed to delete persona');
      }
    });

    async function renderCustomPersonasList() {
      const personas = await window.vitamin.getCustomPersonas();

      if (personas.length === 0) {
        customPersonasList.style.display = 'block';
        customPersonasList.innerHTML = '<div class="panel-empty">No custom personas yet (à²¥ï¹à²¥) Create your own unique browsing character!</div>';
        return;
      }

      customPersonasList.style.display = 'block';
      customPersonasList.innerHTML = personas.map(p => `
        <div class="custom-persona-item" data-persona-id="${p.id}">
          <span class="custom-persona-name">${escapeHtml(p.name)}</span>
          <div class="custom-persona-actions">
            <button class="custom-persona-btn edit" title="Edit">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </button>
            <button class="custom-persona-btn delete" title="Delete">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"/>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
            </button>
          </div>
        </div>
      `).join('');

      // Add event listeners
      customPersonasList.querySelectorAll('.custom-persona-item').forEach(item => {
        const id = item.dataset.personaId;

        item.querySelector('.edit').addEventListener('click', async () => {
          const persona = await window.vitamin.getCustomPersonaData(`custom_${id}`);
          if (persona) {
            openPersonaBuilder(persona);
          }
        });

        item.querySelector('.delete').addEventListener('click', async () => {
          if (!confirm('Delete this custom persona?')) return;
          const result = await window.vitamin.deleteCustomPersona(id);
          if (result.success) {
            await loadPersonas();
            await renderCustomPersonasList();
            if (currentPersona === `custom_${id}`) {
              personaSelect.value = '';
              currentPersona = null;
              window.vitamin.setPersona(null);
            }
          }
        });
      });
    }

    // Update initSettings to include new toggles
    const originalInitSettings = initSettings;
    async function initSettingsExtended() {
      await originalInitSettings();
      const settings = await window.vitamin.getSettings();
      if (settings) {
        restoreSessionEnabled = settings.restoreSession !== false;
        restoreSessionToggle.classList.toggle('on', restoreSessionEnabled);

        // Always show build persona button and custom personas list (all features free)
        buildPersonaBtn.style.display = 'flex';
        renderCustomPersonasList();

        // Load performance mode setting
        performanceModeEnabled = settings.performanceMode === true;
        performanceModeToggle.classList.toggle('on', performanceModeEnabled);
        performanceModeInfo.style.display = performanceModeEnabled ? 'block' : 'none';

        // Sync to localStorage for start.html to pick up
        localStorage.setItem('vitamin-performance-mode', performanceModeEnabled ? 'true' : 'false');

        // Apply performance mode styles if enabled
        if (performanceModeEnabled) {
          document.body.classList.add('performance-mode');
        }
      }
    }
    initSettingsExtended();

    // Replay onboarding button (now in About modal)
    document.getElementById('replay-onboarding-btn').addEventListener('click', () => {
      window.vitamin.showOnboarding();
      // Close About modal
      document.getElementById('about-modal').classList.remove('open');
      window.vitamin.modalClose();
      // Also close settings if open
      document.getElementById('settings-panel').classList.remove('open');
      window.vitamin.settingsClose();
    });

    // BTC copy button
    document.getElementById('btc-copy-btn').addEventListener('click', async () => {
      const btcAddress = document.getElementById('btc-address').textContent;
      try {
        await navigator.clipboard.writeText(btcAddress);
        const btn = document.getElementById('btc-copy-btn');
        btn.classList.add('copied');
        btn.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>';
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.innerHTML = '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });

    // Appearance Modal
    const appearanceBtn = document.getElementById('appearance-btn');
    const appearanceModal = document.getElementById('appearance-modal');
    const appearanceModalClose = document.getElementById('appearance-modal-close');
    const appearanceName = document.getElementById('appearance-name');
    const appearancePreview = document.getElementById('appearance-preview');
    const themeCards = document.querySelectorAll('.theme-card');
    let currentTheme = 'dark';

    const themeNames = {
      dark: 'Vitamin (D)ark',
      light: 'Vitamin (C)reamsicle',
      blueberry: 'Vitamin (B)luezon',
      acai: 'Vitamin (A)methyst',
      emerald: 'Vitamin (E)nigma'
    };

    const themeColors = {
      dark: '#ff6b00',
      light: '#ff6b00',
      blueberry: '#4a90d9',
      acai: '#9b59b6',
      emerald: '#2ecc71'
    };

    const allThemeClasses = ['light', 'blueberry', 'acai', 'emerald'];

    // Check for saved theme preference
    const savedTheme = localStorage.getItem('vitamin-theme');
    if (savedTheme && themeNames[savedTheme]) {
      currentTheme = savedTheme;
      allThemeClasses.forEach(cls => document.body.classList.remove(cls));
      if (savedTheme !== 'dark') {
        document.body.classList.add(savedTheme);
      }

      // Set theme-specific CSS variables for all highlighted elements
      const themeColor = themeColors[savedTheme] || '#ff6b00';
      document.documentElement.style.setProperty('--accent-theme', themeColor);

      // Set rgba version for backgrounds
      const r = parseInt(themeColor.slice(1, 3), 16);
      const g = parseInt(themeColor.slice(3, 5), 16);
      const b = parseInt(themeColor.slice(5, 7), 16);
      document.documentElement.style.setProperty('--accent-theme-rgba', `rgba(${r}, ${g}, ${b}, 0.1)`);

      appearanceName.textContent = themeNames[savedTheme];
      updatePreviewColor(savedTheme);
      themeCards.forEach(card => {
        const isSelected = card.dataset.theme === savedTheme;
        card.classList.toggle('selected', isSelected);

        // Apply theme-specific selection styles on initialization
        if (isSelected) {
          const themeColor = themeColors[savedTheme] || '#ff6b00';
          const adjustedBgColor = themeColors[savedTheme] ?
            `rgba(${parseInt(themeColor.slice(1, 3), 16)}, ${parseInt(themeColor.slice(3, 5), 16)}, ${parseInt(themeColor.slice(5, 7), 16)}, 0.1)` :
            'rgba(255, 107, 0, 0.1)';

          card.style.borderColor = themeColor;
          card.style.background = adjustedBgColor;

          // Update checkmark color
          const checkmark = card.querySelector('.theme-card-check');
          if (checkmark) {
            checkmark.style.background = themeColor;
            checkmark.style.borderColor = themeColor;
          }
        }
      });
    }

    function updatePreviewColor(theme) {
      const isLight = theme === 'light';
      const bgColor = isLight ? '#ffffff' : '#0d0d0d';
      const accentColor = themeColors[theme] || '#ff6b00';
      appearancePreview.style.background = `linear-gradient(135deg, ${bgColor} 50%, ${accentColor} 50%)`;
    }

    function applyTheme(theme, notifyMain = true) {
      if (theme === currentTheme) return; // Prevent loops
      currentTheme = theme;

      // Remove all theme classes first
      allThemeClasses.forEach(cls => document.body.classList.remove(cls));

      // Add the new theme class (dark is default, no class needed)
      if (theme !== 'dark') {
        document.body.classList.add(theme);
      }

      // Set theme-specific CSS variables for all highlighted elements
      const themeColor = themeColors[theme] || '#ff6b00';
      document.documentElement.style.setProperty('--accent-theme', themeColor);

      // Set rgba version for backgrounds
      const r = parseInt(themeColor.slice(1, 3), 16);
      const g = parseInt(themeColor.slice(3, 5), 16);
      const b = parseInt(themeColor.slice(5, 7), 16);
      document.documentElement.style.setProperty('--accent-theme-rgba', `rgba(${r}, ${g}, ${b}, 0.1)`);

      localStorage.setItem('vitamin-theme', theme);
      appearanceName.textContent = themeNames[theme] || 'Vitamin (D)ark';
      updatePreviewColor(theme);

      themeCards.forEach(card => {
        const isSelected = card.dataset.theme === theme;
        card.classList.toggle('selected', isSelected);

        // Apply theme-specific selection styles
        if (isSelected) {
          const themeColor = themeColors[theme] || '#ff6b00';
          const bgColor = theme === 'light' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(13, 13, 13, 0.1)';
          const adjustedBgColor = themeColors[theme] ?
            `rgba(${parseInt(themeColor.slice(1, 3), 16)}, ${parseInt(themeColor.slice(3, 5), 16)}, ${parseInt(themeColor.slice(5, 7), 16)}, 0.1)` :
            'rgba(255, 107, 0, 0.1)';

          card.style.borderColor = themeColor;
          card.style.background = adjustedBgColor;

          // Update checkmark color
          const checkmark = card.querySelector('.theme-card-check');
          if (checkmark) {
            checkmark.style.background = themeColor;
            checkmark.style.borderColor = themeColor;
          }
        } else {
          // Reset to default styles
          card.style.borderColor = '';
          card.style.background = '';

          // Reset checkmark color
          const checkmark = card.querySelector('.theme-card-check');
          if (checkmark) {
            checkmark.style.background = '';
            checkmark.style.borderColor = '';
          }
        }
      });

      // Send message to all iframes (including start page) about theme change
      // This ensures the Matrix effect starts immediately in the start page
      window.postMessage({ type: 'theme-change', theme: theme }, '*');

      // Only notify main process if triggered by user action
      if (notifyMain) {
        window.vitamin.setTheme(theme);
      }
    }

    appearanceBtn.addEventListener('click', () => {
      appearanceModal.classList.add('open');
      window.vitamin.modalOpen();
    });

    function closeAppearanceModal() {
      appearanceModal.classList.remove('open');
      window.vitamin.modalClose();
    }

    appearanceModalClose.addEventListener('click', closeAppearanceModal);
    appearanceModal.addEventListener('click', (e) => {
      if (e.target === appearanceModal) closeAppearanceModal();
    });

    themeCards.forEach(card => {
      card.addEventListener('click', () => {
        const theme = card.dataset.theme;
        applyTheme(theme, true);
      });
    });

    // Listen for theme changes from main process (don't notify back)
    window.vitamin.onThemeChange((theme) => {
      applyTheme(theme, false);
    });

    // Listen for performance mode changes from main process
    window.vitamin.on('performance-mode-change', (event, enabled) => {
      performanceModeEnabled = enabled;
      performanceModeToggle.classList.toggle('on', enabled);
      performanceModeInfo.style.display = enabled ? 'block' : 'none';
      performanceDetailsBtn.style.display = enabled ? 'block' : 'none';

      // Sync to localStorage for start.html to pick up
      localStorage.setItem('vitamin-performance-mode', enabled ? 'true' : 'false');

      // Apply performance mode styles
      if (enabled) {
        document.body.classList.add('performance-mode');
      } else {
        document.body.classList.remove('performance-mode');
      }
    });

  </script>

<!-- Nuke Modals -->
  <div class="modal-overlay" id="nuke-modal" style="display: none;">
    <div class="nuke-warning-modal">
      <div class="nuke-warning-header">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ff4757" stroke-width="1.5">
          <circle cx="12" cy="12" r="10"/>
          <line x1="12" y1="8" x2="12" y2="12"/>
          <line x1="12" y1="16" x2="12.01" y2="16"/>
        </svg>
        <h2>NUKE WARNING</h2>
      </div>
      <div class="nuke-warning-content">
        <p>This will <span class="warning-text">securely shred (3-pass)</span> ALL browser data:</p>
        <ul class="nuke-data-list">
          <li>Browsing history</li>
          <li>Bookmarks</li>
          <li>Cookies & session data</li>
          <li>Cache & temp files</li>
          <li>Settings & personas</li>
          <li>Saved tabs</li>
          <li>All stored files</li>
        </ul>
        <p class="warning-note">Files are overwritten 3x before deletion. Unrecoverable. Browser will close after.</p>
      </div>
      <div class="nuke-warning-actions">
        <button class="nuke-cancel-btn" id="nuke-cancel">Cancel</button>
        <button class="nuke-confirm-btn" id="nuke-confirm">NUKE IT ALL</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="nuke-progress-modal" style="display: none;">
    <div class="nuke-progress-modal">
      <div class="nuke-animation-container">
        <div class="nuke-core" id="nuke-core"></div>
        <div class="nuke-shockwave" id="nuke-shockwave"></div>
        <div class="nuke-particles" id="nuke-particles"></div>
      </div>
      <div class="nuke-progress-content">
        <h2>SECURE SHRED IN PROGRESS</h2>
        <div class="nuke-countdown" id="nuke-countdown">T-00:00</div>
        <div class="nuke-progress-bar">
          <div class="nuke-progress-fill" id="nuke-progress-fill"></div>
        </div>
        <div class="nuke-status" id="nuke-status">Preparing 3-pass secure shred...</div>
      </div>
    </div>
  </div>
</body>
</html>
